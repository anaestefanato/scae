{% extends 'base2.html' %}
{% set active_page = 'editais' %}

{% block title %}SCAE - Primeira Inscrição{% endblock %}

{% block head %}
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/editais_primeira_inscricao_aluno.css">
{% endblock %}

{% block content %}
<div class="main-content" id="mainContent">
    <!-- Mensagens de feedback -->
    {% if request.query_params.get('msg') %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i>{{ request.query_params.get('msg') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}
    {% if request.query_params.get('erro') %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i>{{ request.query_params.get('erro') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}
    
    <!-- Welcome Banner -->
    <div class="welcome-banner mb-4">
        <div class="row align-items-center">
            <div class="col-12">
                <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-person-plus text-success me-3" style="font-size: 2rem;"></i>
                    <h4 class="mb-0">Primeira Inscrição - Assistência Estudantil</h4>
                </div>
                <p>Realize sua primeira inscrição no programa de assistência estudantil. Preencha todos os dados com atenção e anexe os documentos solicitados.</p>
            </div>
        </div>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps mb-4">
        <div class="step active" id="step-1">
            <span>1</span>
            <div class="step-label">Dados</div>
        </div>
        <div class="step" id="step-2">
            <span>2</span>
            <div class="step-label">Auxílios</div>
        </div>
        <div class="step" id="step-3">
            <span>3</span>
            <div class="step-label">Documentos</div>
        </div>
        <div class="progress-line">
            <div class="progress-line-fill" id="progress-fill"></div>
        </div>
    </div>

    <!-- Information Card -->
    <div class="info-card mb-4">
        <h6><i class="bi bi-info-circle me-2"></i>Requisitos para Participação</h6>
        <ul>
            <li>Estar regularmente matriculado no IFES</li>
            <li>Renda familiar per capita de até 1 salário mínimo</li>
            <li>Não possuir auxílio de outros programas governamentais</li>
            <li>Apresentar toda a documentação exigida</li>
        </ul>
    </div>

    <!-- Form Container -->
    <div class="form-container">
        <div class="form-title">
            <i class="bi bi-person-badge"></i>
            Formulário de Primeira Inscrição 2025
        </div>
        <p class="form-subtitle">
            Complete todas as etapas para efetivar sua inscrição no programa de assistência estudantil.
        </p>

        <form method="post" action="/aluno/editais/primeira-inscricao" enctype="multipart/form-data" id="inscricaoForm">
            <!-- Etapa 1: Preenchimento dos Dados -->
            <div class="form-etapa" id="etapa-1" style="display: block;">
            <!-- Dados Pessoais -->
            <div class="form-section">
                <div class="section-title">
                    <i class="bi bi-person"></i>
                    Dados Pessoais
                </div>
                
                <div class="form-row">
                    <div>
                        <label for="nome" class="form-label required-field">Nome Completo</label>
                        <input type="text" class="form-control {% if campo_erro == 'nome' %}is-invalid{% endif %}" id="nome" name="nome" value="{{ aluno.nome if aluno else '' }}" required>
                    </div>
                    <div>
                        <label for="cpf" class="form-label required-field">CPF</label>
                        <input type="text" class="form-control {% if campo_erro == 'cpf' %}is-invalid{% endif %}" id="cpf" name="cpf" placeholder="000.000.000-00" value="{{ aluno.cpf if aluno and aluno.cpf else '' }}" required>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label for="data_nascimento" class="form-label required-field">Data de Nascimento</label>
                        <input type="date" class="form-control {% if campo_erro == 'data_nascimento' %}is-invalid{% endif %}" id="data_nascimento" name="data_nascimento" value="{{ aluno.data_nascimento if aluno and aluno.data_nascimento else '' }}" required>
                    </div>
                    <div>
                        <label for="telefone" class="form-label required-field">Telefone</label>
                        <input type="tel" class="form-control {% if campo_erro == 'telefone' %}is-invalid{% endif %}" id="telefone" name="telefone" placeholder="(00) 00000-0000" value="{{ aluno.telefone if aluno and aluno.telefone else '' }}" required>
                    </div>
                </div>

                <div class="form-row single-column">
                    <div>
                        <label for="email" class="form-label required-field">E-mail</label>
                        <input type="email" class="form-control {% if campo_erro == 'email' %}is-invalid{% endif %}" id="email" name="email" value="{{ aluno.email if aluno else '' }}" required>
                        <div class="form-text">Será usado para todas as comunicações do programa</div>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label for="logradouro" class="form-label required-field">Logradouro (Rua/Avenida)</label>
                        <input type="text" class="form-control" id="logradouro" name="logradouro" placeholder="Ex: Rua das Flores" value="{{ aluno.rua if aluno and aluno.rua else '' }}" required>
                    </div>
                    <div>
                        <label for="numero" class="form-label required-field">Número</label>
                        <input type="text" class="form-control" id="numero" name="numero" placeholder="Ex: 123" value="{{ aluno.numero if aluno and aluno.numero else '' }}" required>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label for="complemento" class="form-label">Complemento</label>
                        <input type="text" class="form-control" id="complemento" name="complemento" placeholder="Ex: Apto 201, Bloco B" value="{{ aluno.complemento if aluno and aluno.complemento else '' }}">
                    </div>
                    <div></div>
                </div>

                <div class="form-row">
                    <div>
                        <label for="cep" class="form-label required-field">CEP</label>
                        <div class="input-group">
                            <input type="text" class="form-control {% if campo_erro == 'cep' %}is-invalid{% endif %}" id="cep" name="cep" placeholder="00000-000" maxlength="9" value="{{ aluno.cep if aluno and aluno.cep else '' }}" required>
                            <button class="btn btn-outline-secondary" type="button" id="btn-buscar-cep" disabled>
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                        <div id="cep-loading" class="form-text text-primary" style="display: none;">
                            <i class="bi bi-hourglass-split"></i> Buscando CEP...
                        </div>
                        <div id="cep-error" class="form-text text-danger" style="display: none;">
                            <i class="bi bi-exclamation-triangle"></i> CEP não encontrado
                        </div>
                    </div>
                    <div>
                        <label for="cidade" class="form-label required-field">Cidade</label>
                        <input type="text" class="form-control" id="cidade" name="cidade" placeholder="Ex: Cachoeiro de Itapemirim" value="{{ aluno.cidade if aluno and aluno.cidade else '' }}" required>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label for="bairro" class="form-label required-field">Bairro</label>
                        <input type="text" class="form-control" id="bairro" name="bairro" placeholder="Ex: Centro" value="{{ aluno.bairro if aluno and aluno.bairro else '' }}" required>
                    </div>
                    <div>
                        <label for="estado" class="form-label required-field">Estado</label>
                        <input type="text" class="form-control" id="estado" name="estado" placeholder="Ex: ES" maxlength="2" value="{{ aluno.estado if aluno and aluno.estado else '' }}" required>
                    </div>
                </div>
            </div>

            <!-- Dados Acadêmicos -->
            <div class="form-section">
                <div class="section-title">
                    <i class="bi bi-mortarboard"></i>
                    Dados Acadêmicos
                </div>
                
                <div class="form-row">
                    <div>
                        <label for="curso" class="form-label required-field">Curso</label>
                        <input type="text" class="form-control" id="curso" name="curso" value="{{ aluno.curso if aluno and aluno.curso else '' }}" required>
                    </div>
                    <div>
                        <label for="matricula" class="form-label required-field">Matrícula</label>
                        <input type="text" class="form-control {% if campo_erro == 'matricula' %}is-invalid{% endif %}" id="matricula" name="matricula" value="{{ aluno.matricula if aluno else '' }}" required>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label for="ano_ingresso" class="form-label required-field">Ano de Ingresso</label>
                        <input type="number" class="form-control {% if campo_erro == 'ano_ingresso' %}is-invalid{% endif %}" id="ano_ingresso" name="ano_ingresso" placeholder="Ex: 2024" min="2000" max="2030" required>
                    </div>
                    <div>
                        <label for="ano_conclusao_previsto" class="form-label required-field">Ano Previsto para Conclusão</label>
                        <input type="number" class="form-control {% if campo_erro == 'ano_conclusao_previsto' %}is-invalid{% endif %}" id="ano_conclusao_previsto" name="ano_conclusao_previsto" placeholder="Ex: 2028" min="2024" max="2035" required>
                    </div>
                </div>
            </div>

            <!-- Dados Financeiros -->
            <div class="form-section">
                <div class="section-title">
                    <i class="bi bi-cash-stack"></i>
                    Dados Financeiros
                </div>

                <div class="form-row">
                    <div>
                        <label for="pessoas_residencia" class="form-label required-field">Quantas pessoas residem com você?</label>
                        <input type="number" class="form-control {% if campo_erro == 'pessoas_residencia' %}is-invalid{% endif %}" id="pessoas_residencia" name="pessoas_residencia" min="0" placeholder="Ex: 3" value="{{ aluno.quantidade_pessoas if aluno and aluno.quantidade_pessoas else '' }}" required>
                    </div>
                    <div>
                        <label for="renda_percapita" class="form-label required-field">Renda Familiar Per Capita</label>
                        <select class="form-control {% if campo_erro == 'renda_percapita' %}is-invalid{% endif %}" id="renda_percapita" name="renda_percapita" required>
                            <option value="">Selecione...</option>
                            <option value="menor_1" {% if aluno and aluno.renda_per_capita and aluno.renda_per_capita <= 1412 %}selected{% endif %}>Menor ou igual a 1 salário mínimo</option>
                            <option value="ate_1_5" {% if aluno and aluno.renda_per_capita and aluno.renda_per_capita > 1412 and aluno.renda_per_capita <= 2118 %}selected{% endif %}>Até 1,5 salário mínimo</option>
                            <option value="maior_1_5" {% if aluno and aluno.renda_per_capita and aluno.renda_per_capita > 2118 %}selected{% endif %}>Maior que 1,5 salário mínimo</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label for="bolsa_pesquisa" class="form-label required-field">Você recebe alguma bolsa de pesquisa ou estágio?</label>
                        <select class="form-control" id="bolsa_pesquisa" name="bolsa_pesquisa" required>
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                    <div>
                        <label for="cad_unico" class="form-label required-field">Está inscrito no programa CAD Único?</label>
                        <select class="form-control" id="cad_unico" name="cad_unico" required>
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label for="bolsa_familia" class="form-label required-field">Recebe Bolsa Família?</label>
                        <select class="form-control" id="bolsa_familia" name="bolsa_familia" required>
                            <option value="">Selecione...</option>
                            <option value="sim">Sim</option>
                            <option value="nao">Não</option>
                        </select>
                    </div>
                    <div></div>
                </div>
            </div>
            </div>
            <!-- Fim Etapa 1 -->

            <!-- Etapa 2: Escolha de Auxílios -->
            <div class="form-etapa" id="etapa-2" style="display: none;">
                <div class="form-section">
                    <div class="section-title">
                        <i class="bi bi-card-checklist"></i>
                        Escolha de Auxílios
                    </div>
                    
                    <div class="form-row single-column">
                        <div>
                            <label class="form-label required-field">Selecione os auxílios que deseja receber:</label>
                            <div class="checkbox-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="auxilio_alimentacao" name="auxilios" value="alimentacao">
                                    <label class="form-check-label" for="auxilio_alimentacao">
                                        <i class="bi bi-egg-fried text-warning me-2"></i>
                                        <strong>Auxílio Alimentação</strong> - R$ 600,00/mês
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="auxilio_moradia" name="auxilios" value="moradia" onchange="toggleDocumentosMoradia()">
                                    <label class="form-check-label" for="auxilio_moradia">
                                        <i class="bi bi-house-door text-primary me-2"></i>
                                        <strong>Auxílio Moradia</strong> - R$ 400,00/mês
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="auxilio_transporte" name="auxilios" value="transporte" onchange="toggleDocumentosTransporte()">
                                    <label class="form-check-label" for="auxilio_transporte">
                                        <i class="bi bi-bus-front text-success me-2"></i>
                                        <strong>Auxílio Transporte</strong> - R$ 300,00/mês
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="auxilio_material" name="auxilios" value="material">
                                    <label class="form-check-label" for="auxilio_material">
                                        <i class="bi bi-book text-info me-2"></i>
                                        <strong>Auxílio Material Didático</strong> - R$ 200,00/semestre
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Perguntas sobre Transporte -->
                <div class="form-section" id="perguntas-transporte" style="display: none;">
                    <div class="section-title">
                        <i class="bi bi-question-circle"></i>
                        Informações sobre Transporte
                    </div>
                    
                    <div class="form-row single-column">
                        <div>
                            <label class="form-label required-field">Qual tipo de transporte você utiliza para vir até o campus?</label>
                            <div class="radio-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="transporte_van" name="tipo_transporte" value="van" onchange="toggleTipoTransporte()">
                                    <label class="form-check-label" for="transporte_van">
                                        <i class="bi bi-minecart text-primary me-2"></i>
                                        <strong>Van Escolar</strong>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="transporte_onibus" name="tipo_transporte" value="onibus" onchange="toggleTipoTransporte()">
                                    <label class="form-check-label" for="transporte_onibus">
                                        <i class="bi bi-bus-front text-success me-2"></i>
                                        <strong>Ônibus</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Opções de Ônibus -->
                    <div class="form-row single-column" id="opcoes-onibus" style="display: none;">
                        <div>
                            <label class="form-label required-field">Tipo de ônibus (pode selecionar mais de um):</label>
                            <div class="checkbox-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="onibus_municipal" name="tipo_onibus" value="municipal">
                                    <label class="form-check-label" for="onibus_municipal">
                                        <i class="bi bi-building text-info me-2"></i>
                                        <strong>Ônibus Municipal</strong>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="onibus_intermunicipal" name="tipo_onibus" value="intermunicipal">
                                    <label class="form-check-label" for="onibus_intermunicipal">
                                        <i class="bi bi-signpost-2 text-warning me-2"></i>
                                        <strong>Ônibus Intermunicipal</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gasto com Ônibus (Diário) -->
                    <div class="form-row single-column" id="gasto-onibus" style="display: none;">
                        <div>
                            <label for="gasto_passagens_dia" class="form-label required-field">Quanto você gasta com passagens em um dia (ida e volta)?</label>
                            <div class="input-group" style="max-width: 500px; height: 45px;">
                                <span class="input-group-text" style="min-width: 50px; height: 45px; display: flex; align-items: center; justify-content: center;">R$</span>
                                <input type="number" class="form-control {% if campo_erro == 'gasto_passagens_dia' %}is-invalid{% endif %}" id="gasto_passagens_dia" name="gasto_passagens_dia" placeholder="Ex: 12.00" step="0.01" min="0" style="height: 45px;">
                            </div>
                            <div class="form-text">Informe o valor total gasto diariamente com passagens (ida + volta)</div>
                        </div>
                    </div>

                    <!-- Gasto com Van Escolar (Mensal) -->
                    <div class="form-row single-column" id="gasto-van" style="display: none;">
                        <div>
                            <label for="gasto_van_mensal" class="form-label required-field">Quanto você gasta mensalmente com a van escolar?</label>
                            <div class="input-group" style="max-width: 500px; height: 45px;">
                                <span class="input-group-text" style="min-width: 50px; height: 45px; display: flex; align-items: center; justify-content: center;">R$</span>
                                <input type="number" class="form-control {% if campo_erro == 'gasto_van_mensal' %}is-invalid{% endif %}" id="gasto_van_mensal" name="gasto_van_mensal" placeholder="Ex: 300.00" step="0.01" min="0" style="height: 45px;">
                            </div>
                            <div class="form-text">Informe o valor mensal pago pelo serviço de van escolar</div>
                        </div>
                    </div>
                </div>

                <!-- Documentação Específica para Transporte -->
                <div class="form-section" id="docs-transporte" style="display: none;">
                    <div class="section-title">
                        <i class="bi bi-file-earmark-text"></i>
                        Documentação Específica - Auxílio Transporte
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Escolha UMA das opções abaixo:</strong>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="comprovante_residencia_transporte" class="form-label required-field">Comprovante de Residência Recente</label>
                            <input type="file" class="form-control" id="comprovante_residencia_transporte" name="comprovante_residencia_transporte" accept="application/pdf">
                            <div class="form-text">Documento atualizado</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="passe_escolar_frente" class="form-label">Foto Cartão Passe Escolar (Frente)</label>
                            <input type="file" class="form-control" id="passe_escolar_frente" name="passe_escolar_frente" accept="image/*,application/pdf">
                        </div>
                        <div>
                            <label for="passe_escolar_verso" class="form-label">Foto Cartão Passe Escolar (Verso)</label>
                            <input type="file" class="form-control" id="passe_escolar_verso" name="passe_escolar_verso" accept="image/*,application/pdf">
                        </div>
                    </div>

                    <div class="form-row single-column">
                        <div>
                            <label for="comprovante_recarga" class="form-label">Último Comprovante de Recarga do Cartão</label>
                            <input type="file" class="form-control" id="comprovante_recarga" name="comprovante_recarga" accept="image/*,application/pdf">
                            <div class="form-text">Com menos de 2 meses</div>
                        </div>
                    </div>

                    <div class="separator-ou">OU</div>

                    <div class="form-row single-column">
                        <div>
                            <label for="comprovante_passagens" class="form-label">Comprovante de Pagamento de Passagens</label>
                            <input type="file" class="form-control" id="comprovante_passagens" name="comprovante_passagens" accept="application/pdf">
                            <div class="form-text">2 viagens de ida e 2 de volta, com data a partir do início das aulas</div>
                        </div>
                    </div>

                    <div class="separator-ou">OU</div>

                    <div class="form-row single-column">
                        <div>
                            <label for="contrato_transporte" class="form-label">Contrato de Transporte Escolar</label>
                            <input type="file" class="form-control" id="contrato_transporte" name="contrato_transporte" accept="application/pdf">
                            <div class="form-text">Cópia do contrato atual de serviço</div>
                        </div>
                    </div>
                </div>

                <!-- Documentação Específica para Moradia -->
                <div class="form-section" id="docs-moradia" style="display: none;">
                    <div class="section-title">
                        <i class="bi bi-file-earmark-text"></i>
                        Documentação Específica - Auxílio Moradia
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="comprovante_residencia_anterior" class="form-label required-field">Comprovante de Residência do Endereço Anterior</label>
                            <input type="file" class="form-control" id="comprovante_residencia_anterior" name="comprovante_residencia_anterior" accept="application/pdf">
                            <div class="form-text">Endereço antes de mudar-se para a cidade do campus</div>
                        </div>
                        <div>
                            <label for="comprovante_residencia_atual" class="form-label required-field">Comprovante de Residência Atual</label>
                            <input type="file" class="form-control" id="comprovante_residencia_atual" name="comprovante_residencia_atual" accept="application/pdf">
                            <div class="form-text">Do imóvel alugado na cidade do campus</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="contrato_aluguel_atual" class="form-label required-field">Contrato de Aluguel Atual</label>
                            <input type="file" class="form-control" id="contrato_aluguel_atual" name="contrato_aluguel_atual" accept="application/pdf">
                            <div class="form-text">Imóvel na cidade do campus em nome do estudante, pais ou responsáveis</div>
                        </div>
                        <div>
                            <label for="contrato_aluguel_anterior" class="form-label">Contrato de Aluguel Anterior</label>
                            <input type="file" class="form-control" id="contrato_aluguel_anterior" name="contrato_aluguel_anterior" accept="application/pdf">
                            <div class="form-text">Se a moradia anterior foi alugada (opcional)</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Fim Etapa 2 -->

            <!-- Etapa 3: Upload de Documentos -->
            <div class="form-etapa" id="etapa-3" style="display: none;">
            <!-- Upload de Documentos -->
            <div class="form-section">
                <div class="section-title">
                    <i class="bi bi-cloud-upload"></i>
                    Documentos Obrigatórios
                </div>
                
                <div class="form-row single-column">
                    <div>
                        <label for="anexo_documentos" class="form-label required-field">Documento de Identificação</label>
                        <input type="file" class="form-control" id="anexo_documentos" name="anexo_documentos" accept="application/pdf" required>
                        <div class="file-upload-helper">
                            <i class="bi bi-info-circle"></i>
                            Documento de identificação da(o) estudante e de todas as pessoas que residem no mesmo imóvel (PDF, máx. 10MB)
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div>
                        <label for="anexo_1" class="form-label required-field">Anexo I - Termo Comprobatório de Declaração de Renda</label>
                        <input type="file" class="form-control" id="anexo_1" name="anexo_1" accept="application/pdf" required>
                        <div class="file-upload-helper">
                            <i class="bi bi-info-circle"></i>
                            Anexo I devidamente preenchido (PDF, máx. 10MB)
                        </div>
                    </div>
                    <div>
                        <label for="anexo_3" class="form-label required-field">Anexo III - Termo de Responsabilidade</label>
                        <input type="file" class="form-control" id="anexo_3" name="anexo_3" accept="application/pdf" required>
                        <div class="file-upload-helper">
                            <i class="bi bi-info-circle"></i>
                            Anexo III devidamente preenchido (PDF, máx. 10MB)
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <!-- Fim Etapa 3 -->

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="btn-voltar" onclick="voltarEtapa()" style="display: none;">
                    <i class="bi bi-arrow-left me-2"></i>Voltar
                </button>
                <button type="button" class="btn btn-primary" id="btn-proxima" onclick="proximaEtapa()">
                    <i class="bi bi-arrow-right me-2"></i>Próxima Etapa
                </button>
                <button type="submit" class="btn btn-success" id="btn-enviar" style="display: none;">
                    <i class="bi bi-send me-2"></i>Enviar Inscrição
                </button>
            </div>
        </form>
    </div>

    <!-- Information Cards -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-calendar-check me-2"></i>Cronograma
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><i class="bi bi-circle-fill text-success me-2" style="font-size: 0.5rem;"></i>Inscrições: <strong>01/02 a 28/02/2025</strong></li>
                        <li><i class="bi bi-circle-fill text-warning me-2" style="font-size: 0.5rem;"></i>Análise: <strong>01/03 a 14/03/2025</strong></li>
                        <li><i class="bi bi-circle-fill text-info me-2" style="font-size: 0.5rem;"></i>Resultado: <strong>15/03/2025</strong></li>
                        <li><i class="bi bi-circle-fill text-secondary me-2" style="font-size: 0.5rem;"></i>Recursos: <strong>16/03 a 20/03/2025</strong></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-cash-stack me-2"></i>Auxílios Disponíveis
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><i class="bi bi-check-circle text-success me-2"></i>Alimentação: <strong>R$ 600,00/mês</strong></li>
                        <li><i class="bi bi-check-circle text-success me-2"></i>Transporte: <strong>R$ 300,00/mês</strong></li>
                        <li><i class="bi bi-check-circle text-success me-2"></i>Moradia: <strong>R$ 400,00/mês</strong></li>
                        <li><i class="bi bi-check-circle text-success me-2"></i>Material: <strong>R$ 200,00/semestre</strong></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Contact Information -->
    <div class="card mt-4">
        <div class="card-header">
            <i class="bi bi-headset me-2"></i>Precisa de Ajuda?
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-success">Contato</h6>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-envelope text-primary me-2"></i>assistencia.estudantil@ifes.edu.br</li>
                        <li><i class="bi bi-telephone text-primary me-2"></i>(27) 3333-2222</li>
                        <li><i class="bi bi-whatsapp text-success me-2"></i>(27) 99999-8888</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6 class="text-success">Atendimento</h6>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-clock text-info me-2"></i>Segunda a Sexta: 8h às 17h</li>
                        <li><i class="bi bi-geo-alt text-danger me-2"></i>Setor de Assistência Estudantil</li>
                        <li><i class="bi bi-building text-secondary me-2"></i>Prédio Administrativo - Sala 101</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/editais_primeira_inscricao_aluno.js"></script>
<script>
let etapaAtual = 1;

function atualizarBarraProgresso() {
    const progressFill = document.getElementById('progress-fill');
    
    // Etapa 1: 0%, Etapa 2: 50%, Etapa 3: 100%
    let porcentagem;
    if (etapaAtual === 1) {
        porcentagem = 0;
    } else if (etapaAtual === 2) {
        porcentagem = 50;
    } else if (etapaAtual === 3) {
        porcentagem = 100;
    }
    
    progressFill.style.width = porcentagem + '%';
}

async function proximaEtapa() {
    if (etapaAtual < 3) {
        // VALIDAR ETAPA 1 COM DTO DO BACKEND
        if (etapaAtual === 1) {
            const validacao = await validarEtapa1ComDTO();
            if (!validacao.valido) {
                return; // Não avançar se houver erros
            }
        }
        
        // Esconder etapa atual
        document.getElementById('etapa-' + etapaAtual).style.display = 'none';
        document.getElementById('step-' + etapaAtual).classList.remove('active');
        document.getElementById('step-' + etapaAtual).classList.add('completed');
        
        // Avançar etapa
        etapaAtual++;
        
        // Mostrar próxima etapa
        document.getElementById('etapa-' + etapaAtual).style.display = 'block';
        document.getElementById('step-' + etapaAtual).classList.add('active');
        
        // Atualizar barra de progresso
        atualizarBarraProgresso();
        
        // Controlar botões
        document.getElementById('btn-voltar').style.display = 'inline-block';
        
        if (etapaAtual === 3) {
            document.getElementById('btn-proxima').style.display = 'none';
            document.getElementById('btn-enviar').style.display = 'inline-block';
        }
        
        // Scroll para o topo
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

// Validar Etapa 1 usando DTO do backend
async function validarEtapa1ComDTO() {
    // Desabilitar botão durante validação
    const btnProxima = document.getElementById('btn-proxima');
    const textoOriginal = btnProxima.innerHTML;
    btnProxima.disabled = true;
    btnProxima.innerHTML = '<i class="spinner-border spinner-border-sm me-2"></i>Validando...';
    
    try {
        // Coletar dados do formulário
        const formData = new FormData(document.querySelector('form'));
        
        // Fazer requisição para endpoint de validação
        const response = await fetch('/aluno/editais/primeira-inscricao/validar', {
            method: 'POST',
            body: formData
        });
        
        const resultado = await response.json();
        
        if (resultado.valido) {
            // Dados válidos - limpar todos os erros
            limparErrosValidacao();
            return { valido: true };
        } else {
            // Dados inválidos - mostrar erros
            mostrarErrosDTO(resultado.erros);
            
            // Mostrar alerta
            mostrarAlerta(
                'Erro de Validação',
                resultado.mensagem || 'Por favor, corrija os campos destacados.',
                'danger'
            );
            
            return { valido: false, erros: resultado.erros };
        }
        
    } catch (error) {
        console.error('Erro ao validar dados:', error);
        mostrarAlerta(
            'Erro',
            'Não foi possível validar os dados. Tente novamente.',
            'danger'
        );
        return { valido: false };
        
    } finally {
        // Reabilitar botão
        btnProxima.disabled = false;
        btnProxima.innerHTML = textoOriginal;
    }
}

// Mostrar erros retornados pelo DTO
function mostrarErrosDTO(erros) {
    // Limpar erros anteriores
    limparErrosValidacao();
    
    let primeiroComErro = null;
    
    erros.forEach(erro => {
        const campo = document.querySelector(`[name="${erro.campo}"]`);
        if (campo) {
            // Marcar campo como inválido
            campo.classList.add('is-invalid');
            campo.classList.remove('is-valid');
            
            // Adicionar mensagem de erro
            const feedback = document.createElement('div');
            feedback.className = 'invalid-feedback';
            feedback.textContent = erro.mensagem;
            campo.parentElement.appendChild(feedback);
            
            if (!primeiroComErro) {
                primeiroComErro = campo;
            }
        }
    });
    
    // Focar no primeiro campo com erro
    if (primeiroComErro) {
        primeiroComErro.scrollIntoView({ behavior: 'smooth', block: 'center' });
        setTimeout(() => primeiroComErro.focus(), 500);
    }
}

// Limpar todos os erros de validação
function limparErrosValidacao() {
    // Remover classes de erro
    document.querySelectorAll('.is-invalid').forEach(campo => {
        campo.classList.remove('is-invalid');
    });
    
    // Remover mensagens de erro
    document.querySelectorAll('.invalid-feedback').forEach(feedback => {
        feedback.remove();
    });
}



function mostrarAlerta(titulo, mensagem, tipo = 'info') {
    // Remover alerta anterior se existir
    const alertaAntigo = document.querySelector('.alert-validacao-etapa');
    if (alertaAntigo) alertaAntigo.remove();
    
    // Criar novo alerta
    const alerta = document.createElement('div');
    alerta.className = `alert alert-${tipo} alert-dismissible fade show alert-validacao-etapa`;
    alerta.style.cssText = 'position: fixed; top: 80px; right: 20px; z-index: 9999; min-width: 350px; max-width: 500px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
    alerta.innerHTML = `
        <h5 class="alert-heading"><i class="bi bi-exclamation-triangle-fill me-2"></i>${titulo}</h5>
        <p class="mb-0">${mensagem}</p>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alerta);
    
    // Auto-remover após 6 segundos
    setTimeout(() => {
        if (alerta.parentNode) {
            alerta.classList.remove('show');
            setTimeout(() => alerta.remove(), 150);
        }
    }, 6000);
}

function voltarEtapa() {
    if (etapaAtual > 1) {
        // Esconder etapa atual
        document.getElementById('etapa-' + etapaAtual).style.display = 'none';
        document.getElementById('step-' + etapaAtual).classList.remove('active');
        document.getElementById('step-' + etapaAtual).classList.remove('completed');
        
        // Voltar etapa
        etapaAtual--;
        
        // Mostrar etapa anterior
        document.getElementById('etapa-' + etapaAtual).style.display = 'block';
        document.getElementById('step-' + etapaAtual).classList.add('active');
        document.getElementById('step-' + etapaAtual).classList.remove('completed');
        
        // Atualizar barra de progresso
        atualizarBarraProgresso();
        
        // Controlar botões
        if (etapaAtual === 1) {
            document.getElementById('btn-voltar').style.display = 'none';
        }
        
        document.getElementById('btn-proxima').style.display = 'inline-block';
        document.getElementById('btn-enviar').style.display = 'none';
        
        // Scroll para o topo
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

// Inicializar barra de progresso
document.addEventListener('DOMContentLoaded', function() {
    atualizarBarraProgresso();
});

function toggleDocumentosTransporte() {
    const checkbox = document.getElementById('auxilio_transporte');
    const perguntasSection = document.getElementById('perguntas-transporte');
    const docsSection = document.getElementById('docs-transporte');
    
    if (checkbox.checked) {
        perguntasSection.style.display = 'block';
        docsSection.style.display = 'block';
    } else {
        perguntasSection.style.display = 'none';
        docsSection.style.display = 'none';
        // Limpar seleções
        document.querySelectorAll('input[name="tipo_transporte"]').forEach(radio => radio.checked = false);
        document.getElementById('opcoes-onibus').style.display = 'none';
        document.getElementById('gasto-onibus').style.display = 'none';
        document.getElementById('gasto-van').style.display = 'none';
    }
}

function toggleDocumentosMoradia() {
    const checkbox = document.getElementById('auxilio_moradia');
    const docsSection = document.getElementById('docs-moradia');
    
    if (checkbox.checked) {
        docsSection.style.display = 'block';
    } else {
        docsSection.style.display = 'none';
    }
}

function toggleTipoTransporte() {
    const vanRadio = document.getElementById('transporte_van');
    const onibusRadio = document.getElementById('transporte_onibus');
    const opcoesOnibus = document.getElementById('opcoes-onibus');
    const gastoOnibus = document.getElementById('gasto-onibus');
    const gastoVan = document.getElementById('gasto-van');
    
    if (vanRadio.checked) {
        // Mostrar campo de gasto com van
        gastoVan.style.display = 'block';
        // Ocultar opções de ônibus
        opcoesOnibus.style.display = 'none';
        gastoOnibus.style.display = 'none';
        // Limpar seleções de ônibus (checkboxes)
        document.querySelectorAll('input[name="tipo_onibus"]').forEach(checkbox => checkbox.checked = false);
    } else if (onibusRadio.checked) {
        // Mostrar opções de ônibus
        opcoesOnibus.style.display = 'block';
        gastoOnibus.style.display = 'block';
        // Ocultar campo de van
        gastoVan.style.display = 'none';
    }
}

// Validação do formulário antes de enviar
document.getElementById('inscricaoForm').addEventListener('submit', function(e) {
    // Mostrar mensagem de carregamento
    const btnEnviar = document.getElementById('btn-enviar');
    if (btnEnviar) {
        btnEnviar.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Enviando...';
        btnEnviar.disabled = true;
    }
    
    // Permitir que o formulário seja enviado (validações são feitas no backend)
    return true;
});

// Busca de CEP usando ViaCEP
document.addEventListener('DOMContentLoaded', function() {
    const cepInput = document.getElementById('cep');
    const btnBuscarCep = document.getElementById('btn-buscar-cep');
    const cepLoading = document.getElementById('cep-loading');
    const cepError = document.getElementById('cep-error');
    const cidadeInput = document.getElementById('cidade');
    const bairroInput = document.getElementById('bairro');
    const logradouroInput = document.getElementById('logradouro');
    const estadoInput = document.getElementById('estado');

    // Função para formatar CEP
    function formatarCEP(cep) {
        cep = cep.replace(/\D/g, '');
        if (cep.length > 5) {
            cep = cep.substring(0, 5) + '-' + cep.substring(5, 8);
        }
        return cep;
    }

    // Função para validar CEP
    function validarCEP(cep) {
        const cepLimpo = cep.replace(/\D/g, '');
        return cepLimpo.length === 8 && /^\d{8}$/.test(cepLimpo);
    }

    // Função para limpar campos de endereço
    function limparEndereco() {
        logradouroInput.value = '';
        bairroInput.value = '';
        cidadeInput.value = '';
        estadoInput.value = '';
    }

    // Função para buscar CEP na API ViaCEP
    async function buscarCEP(cep) {
        const cepLimpo = cep.replace(/\D/g, '');
        
        try {
            cepLoading.style.display = 'block';
            cepError.style.display = 'none';
            btnBuscarCep.disabled = true;

            const response = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
            const data = await response.json();

            if (data.erro) {
                throw new Error('CEP não encontrado');
            }

            // Preencher campos automaticamente
            if (data.logradouro) {
                logradouroInput.value = data.logradouro;
            }
            
            if (data.bairro) {
                bairroInput.value = data.bairro;
            }
            
            if (data.localidade) {
                cidadeInput.value = data.localidade;
            }
            
            if (data.uf) {
                estadoInput.value = data.uf;
            }

            // Mostrar mensagem de sucesso
            cepLoading.innerHTML = '<i class="bi bi-check-circle"></i> CEP encontrado!';
            cepLoading.className = 'form-text text-success';
            
            setTimeout(() => {
                cepLoading.style.display = 'none';
                cepLoading.innerHTML = '<i class="bi bi-hourglass-split"></i> Buscando CEP...';
                cepLoading.className = 'form-text text-primary';
            }, 2000);

        } catch (error) {
            cepError.style.display = 'block';
            cepLoading.style.display = 'none';
            limparEndereco();
        } finally {
            btnBuscarCep.disabled = false;
        }
    }

    // Event listener para formatação automática do CEP
    cepInput.addEventListener('input', function(e) {
        e.target.value = formatarCEP(e.target.value);
        
        const cepValido = validarCEP(e.target.value);
        btnBuscarCep.disabled = !cepValido;
        
        if (cepValido) {
            btnBuscarCep.classList.remove('btn-outline-secondary');
            btnBuscarCep.classList.add('btn-outline-primary');
        } else {
            btnBuscarCep.classList.remove('btn-outline-primary');
            btnBuscarCep.classList.add('btn-outline-secondary');
        }
        
        cepError.style.display = 'none';
        cepLoading.style.display = 'none';
    });

    // Event listener para busca automática ao sair do campo
    cepInput.addEventListener('blur', function(e) {
        if (validarCEP(e.target.value)) {
            buscarCEP(e.target.value);
        }
    });

    // Event listener para o botão de busca
    btnBuscarCep.addEventListener('click', function() {
        if (validarCEP(cepInput.value)) {
            buscarCEP(cepInput.value);
        }
    });

    // Event listener para busca com Enter
    cepInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            if (validarCEP(e.target.value)) {
                buscarCEP(e.target.value);
            }
        }
    });
});

// Máscaras para formatação
document.addEventListener('DOMContentLoaded', function() {
    // Máscara para CPF
    const cpfInput = document.getElementById('cpf');
    if (cpfInput) {
        cpfInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                e.target.value = value;
            }
        });
    }
    
    // Máscara para telefone
    const telefoneInput = document.getElementById('telefone');
    if (telefoneInput) {
        telefoneInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
                value = value.replace(/(\d)(\d{4})$/, '$1-$2');
                e.target.value = value;
            }
        });
    }
});
</script>
{% endblock %}
