{% extends 'base2.html' %}
{% set active_page = 'notificacoes' %}

{% block title %}SCAE - Notificações{% endblock %}

{% block head %}
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/notificacoes.css">
{% endblock %}

{% block content %}
<div class="main-content" id="mainContent">
    <!-- Card principal com borda verde - apenas para o header -->
    <div class="card main-card">
        <div class="card-body">
            <!-- Header da página -->
            <div class="page-header mb-0">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="page-title" style="color: #333333;">Central de Notificações</h2>
                        <p class="page-subtitle">Acompanhe todas as atualizações importantes sobre seus auxílios e processos</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estatísticas das Notificações -->
    <div class="notification-stats">
        <div class="stat-card">
            <span class="stat-number" id="totalNotifications">8</span>
            <span class="stat-label">Total</span>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="unreadNotifications">3</span>
            <span class="stat-label">Não lidas</span>
        </div>
        <div class="stat-card">
            <span class="stat-number" id="importantNotifications">1</span>
            <span class="stat-label">Importantes</span>
        </div>
        <div class="stat-card">
            <button class="btn btn-outline-success btn-sm w-100" onclick="markAllAsRead()">
                <i class="bi bi-check2-all me-1"></i>Marcar todas como lidas
            </button>
        </div>
    </div>

        <!-- Filtros -->
        <div class="filter-tabs">
            <ul class="nav nav-pills" id="notificationTabs">
                <li class="nav-item">
                    <button class="nav-link active" data-filter="all">Todas (8)</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-filter="unread">Não lidas (3)</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-filter="important">Importantes (1)</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-filter="auxilio">Auxílios (5)</button>
                </li>
                <li class="nav-item">
                    <button class="nav-link" data-filter="sistema">Sistema (3)</button>
                </li>
            </ul>
        </div>

        <!-- Lista de Notificações -->
        <div id="notificationsList">
            <!-- Notificação 1 - Não lida, Alta prioridade -->
            <div class="card notification-card unread" data-category="auxilio" data-priority="high" data-id="1">
                <div class="notification-priority priority-high"></div>
                <div class="card-body">
                    <div class="d-flex">
                        <div class="notification-icon warning">
                            <i class="bi bi-exclamation-triangle"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="notification-title">Documento pendente - Ação necessária</h5>
                                <span class="notification-time">Hoje, 14:30</span>
                            </div>
                            <div class="notification-content">
                                Você precisa enviar o comprovante de residência atualizado para o Auxílio Transporte. Prazo: 24/08/2025.
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <button class="mark-read-btn" onclick="markAsRead(1)">
                                    <i class="bi bi-check me-1"></i>Marcar como lida
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="openNotificationModal(1)">
                                    <i class="bi bi-eye me-1"></i>Ver detalhes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notificação 2 - Não lida -->
            <div class="card notification-card unread" data-category="auxilio" data-priority="medium" data-id="2">
                <div class="notification-priority priority-medium"></div>
                <div class="card-body">
                    <div class="d-flex">
                        <div class="notification-icon success">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="notification-title">Auxílio Alimentação aprovado</h5>
                                <span class="notification-time">Ontem, 16:45</span>
                            </div>
                            <div class="notification-content">
                                Parabéns! Seu auxílio alimentação foi aprovado. Valor: R$ 200,00. Primeira liberação: 25/08/2025.
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <button class="mark-read-btn" onclick="markAsRead(2)">
                                    <i class="bi bi-check me-1"></i>Marcar como lida
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="openNotificationModal(2)">
                                    <i class="bi bi-eye me-1"></i>Ver detalhes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notificação 3 - Não lida -->
            <div class="card notification-card unread" data-category="auxilio" data-priority="low" data-id="3">
                <div class="notification-priority priority-low"></div>
                <div class="card-body">
                    <div class="d-flex">
                        <div class="notification-icon info">
                            <i class="bi bi-info-circle"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="notification-title">Novo edital disponível</h5>
                                <span class="notification-time">2 dias atrás</span>
                            </div>
                            <div class="notification-content">
                                O edital para Auxílio Material Didático está aberto. Valor: R$ 300,00. Prazo: 05/05/2025.
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <button class="mark-read-btn" onclick="markAsRead(3)">
                                    <i class="bi bi-check me-1"></i>Marcar como lida
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="inscreverEdital()">
                                    <i class="bi bi-plus-circle me-1"></i>Inscrever-se
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notificação 4 - Lida -->
            <div class="notification-card read card" data-category="auxilio" data-priority="medium" data-id="4">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="notification-icon success">
                            <i class="bi bi-calendar-check"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="notification-title">Recebimento confirmado</h5>
                                <span class="notification-time">3 dias atrás</span>
                            </div>
                            <div class="notification-content">
                                Recebimento do Auxílio Alimentação de março/2025 confirmado com sucesso. Valor: R$ 200,00.
                            </div>
                            <div class="d-flex justify-content-end">
                                <button class="btn btn-sm btn-outline-secondary" onclick="openNotificationModal(4)">
                                    <i class="bi bi-eye me-1"></i>Ver detalhes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notificação 5 - Lida -->
            <div class="card notification-card read" data-category="sistema" data-priority="low" data-id="5">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="notification-icon info">
                            <i class="bi bi-gear"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="notification-title">Atualização do sistema</h5>
                                <span class="notification-time">1 semana atrás</span>
                            </div>
                            <div class="notification-content">
                                O sistema SCAE foi atualizado com melhorias de segurança e novas funcionalidades.
                            </div>
                            <div class="d-flex justify-content-end">
                                <button class="btn btn-sm btn-outline-secondary" onclick="openNotificationModal(5)">
                                    <i class="bi bi-eye me-1"></i>Ver detalhes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notificação 6 - Lida -->
            <div class="card notification-card read" data-category="auxilio" data-priority="medium" data-id="6">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="notification-icon danger">
                            <i class="bi bi-x-circle"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="notification-title">Auxílio Moradia indeferido</h5>
                                <span class="notification-time">2 semanas atrás</span>
                            </div>
                            <div class="notification-content">
                                Sua solicitação de Auxílio Moradia foi indeferida. Motivo: documentação incompleta. Você pode apresentar recurso até 30/08/2025.
                            </div>
                            <div class="d-flex justify-content-end">
                                <button class="btn btn-sm btn-outline-secondary" onclick="openNotificationModal(6)">
                                    <i class="bi bi-eye me-1"></i>Ver detalhes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mais notificações... -->
            <div class="card notification-card read" data-category="sistema" data-priority="low" data-id="7">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="notification-icon info">
                            <i class="bi bi-bell"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="notification-title">Bem-vindo ao SCAE</h5>
                                <span class="notification-time">1 mês atrás</span>
                            </div>
                            <div class="notification-content">
                                Seja bem-vindo ao Sistema de Controle de Assistência Estudantil! Aqui você pode gerenciar todos os seus auxílios.
                            </div>
                            <div class="d-flex justify-content-end">
                                <button class="btn btn-sm btn-outline-secondary" onclick="openNotificationModal(7)">
                                    <i class="bi bi-eye me-1"></i>Ver detalhes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card notification-card read" data-category="sistema" data-priority="low" data-id="8">
                <div class="card-body">
                    <div class="d-flex">
                        <div class="notification-icon success">
                            <i class="bi bi-person-check"></i>
                        </div>
                        <div class="flex-grow-1">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="notification-title">Cadastro aprovado</h5>
                                <span class="notification-time">1 mês atrás</span>
                            </div>
                            <div class="notification-content">
                                Seu cadastro no sistema foi aprovado com sucesso. Agora você pode se inscrever em editais de auxílio.
                            </div>
                            <div class="d-flex justify-content-end">
                                <button class="btn btn-sm btn-outline-secondary" onclick="openNotificationModal(8)">
                                    <i class="bi bi-eye me-1"></i>Ver detalhes
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estado vazio (será mostrado quando não houver notificações) -->
        <div id="emptyState" class="empty-state" style="display: none;">
            <i class="bi bi-bell-slash"></i>
            <h4>Nenhuma notificação encontrada</h4>
            <p>Você não possui notificações nesta categoria.</p>
        </div>
    </div>

    <!-- Modal de Detalhes da Notificação -->
    <div id="notificationModal" class="modal fade" tabindex="-1" role="dialog" aria-modal="true" style="display:none; background: rgba(0,0,0,0.4);">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content shadow-lg">
                <div class="modal-header">
                    <h5 class="modal-title" id="notificationModalLabel">
                        <i class="bi bi-bell me-2"></i>Detalhes da Notificação
                    </h5>
                    <button type="button" class="btn-close" aria-label="Fechar" onclick="closeNotificationModal()"></button>
                </div>
                <div class="modal-body" id="notificationModalBody">
                    <!-- Conteúdo será inserido dinamicamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeNotificationModal()">
                        <i class="bi bi-x-circle me-1"></i>Fechar
                    </button>
                    <button type="button" class="btn btn-success" id="notificationAction">
                        <i class="bi bi-arrow-right me-1"></i>Ação Principal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Aguardar o menu toggle do base2.html ser inicializado
        document.addEventListener('DOMContentLoaded', function() {
            // Aguardar um pouco para não interferir com o base2.html
            setTimeout(function() {
                initializeNotificationsPage();
            }, 100);
        });
        
        function initializeNotificationsPage() {
            // Filtros de notificação
            const filterTabs = document.querySelectorAll('#notificationTabs .nav-link');
            filterTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    filterTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Filter notifications
                    filterNotifications(this.dataset.filter);
                });
            });

            // Close modal when clicking outside
            document.addEventListener('click', function(e) {
                const modal = document.getElementById('notificationModal');
                if (e.target === modal) {
                    closeNotificationModal();
                }
            });
        }

        function filterNotifications(filter) {
            const notifications = document.querySelectorAll('.notification-card');
            const emptyState = document.getElementById('emptyState');
            let visibleCount = 0;

            notifications.forEach(notification => {
                let shouldShow = false;

                switch(filter) {
                    case 'all':
                        shouldShow = true;
                        break;
                    case 'unread':
                        shouldShow = notification.classList.contains('unread');
                        break;
                    case 'important':
                        shouldShow = notification.querySelector('.priority-high') !== null;
                        break;
                    case 'auxilio':
                        shouldShow = notification.dataset.category === 'auxilio';
                        break;
                    case 'sistema':
                        shouldShow = notification.dataset.category === 'sistema';
                        break;
                }

                if (shouldShow) {
                    notification.style.display = 'block';
                    visibleCount++;
                } else {
                    notification.style.display = 'none';
                }
            });

            // Show/hide empty state
            if (visibleCount === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
        }

        function markAsRead(notificationId) {
            const notification = document.querySelector(`[data-id="${notificationId}"]`);
            if (notification) {
                notification.classList.remove('unread');
                notification.classList.add('read');
                
                // Update counters
                updateCounters();
                
                // Show success message
                showToast('Notificação marcada como lida', 'success');
            }
        }

        function markAllAsRead() {
            const unreadNotifications = document.querySelectorAll('.notification-card.unread');
            unreadNotifications.forEach(notification => {
                notification.classList.remove('unread');
                notification.classList.add('read');
            });
            
            updateCounters();
            showToast('Todas as notificações foram marcadas como lidas', 'success');
        }

        function updateCounters() {
            const total = document.querySelectorAll('.notification-card').length;
            const unread = document.querySelectorAll('.notification-card.unread').length;
            const important = document.querySelectorAll('.notification-card .priority-high').length;
            
            document.getElementById('totalNotifications').textContent = total;
            document.getElementById('unreadNotifications').textContent = unread;
            document.getElementById('importantNotifications').textContent = important;
            
            // Update tab counters
            const tabs = document.querySelectorAll('#notificationTabs .nav-link');
            tabs.forEach(tab => {
                const filter = tab.dataset.filter;
                let count = 0;
                
                switch(filter) {
                    case 'all':
                        count = total;
                        break;
                    case 'unread':
                        count = unread;
                        break;
                    case 'important':
                        count = important;
                        break;
                    case 'auxilio':
                        count = document.querySelectorAll('[data-category="auxilio"]').length;
                        break;
                    case 'sistema':
                        count = document.querySelectorAll('[data-category="sistema"]').length;
                        break;
                }
                
                const text = tab.textContent.split('(')[0];
                tab.textContent = `${text}(${count})`;
            });
        }

        function openNotificationModal(notificationId) {
            const modal = document.getElementById('notificationModal');
            const modalBody = document.getElementById('notificationModalBody');
            const modalTitle = document.getElementById('notificationModalLabel');
            const actionButton = document.getElementById('notificationAction');

            // Show modal
            modal.style.display = 'block';
            modal.classList.add('show');

            // Example notification details (in a real app, this would come from an API)
            const notificationDetails = {
                1: {
                    title: 'Documento pendente - Ação necessária',
                    content: `
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i>
                            <strong>Atenção:</strong> Documento requerido com urgência
                        </div>
                        <p><strong>Auxílio:</strong> Auxílio Transporte - Edital 01/2025</p>
                        <p><strong>Documento necessário:</strong> Comprovante de residência atualizado</p>
                        <p><strong>Prazo:</strong> Até 24/08/2025 às 23:59</p>
                        <p><strong>Instruções:</strong></p>
                        <ul>
                            <li>O documento deve ser datado dos últimos 3 meses</li>
                            <li>Formato aceito: PDF, JPG ou PNG</li>
                            <li>Tamanho máximo: 5MB</li>
                        </ul>
                        <p>Para enviar o documento, acesse sua área do aluno e clique em "Meus Auxílios" > "Auxílio Transporte" > "Enviar Documentos".</p>
                    `,
                    action: 'Enviar Documento'
                },
                2: {
                    title: 'Auxílio Alimentação aprovado',
                    content: `
                        <div class="alert alert-success">
                            <i class="bi bi-check-circle"></i>
                            <strong>Parabéns!</strong> Seu auxílio foi aprovado
                        </div>
                        <p><strong>Auxílio:</strong> Auxílio Alimentação - Edital 01/2025</p>
                        <p><strong>Valor aprovado:</strong> R$ 200,00</p>
                        <p><strong>Data de aprovação:</strong> 22/08/2025</p>
                        <p><strong>Primeira liberação:</strong> 25/08/2025</p>
                        <p><strong>Periodicidade:</strong> Mensal</p>
                        <p><strong>Próximos passos:</strong></p>
                        <ul>
                            <li>O valor estará disponível em sua conta a partir de 25/08/2025</li>
                            <li>Você deve confirmar o recebimento mensalmente até o dia 10</li>
                            <li>Acompanhe o calendário de pagamentos na sua área do aluno</li>
                        </ul>
                    `,
                    action: 'Ver Recebimentos'
                }
                // Add more notification details as needed
            };

            const details = notificationDetails[notificationId];
            if (details) {
                modalTitle.innerHTML = `<i class="bi bi-bell me-2"></i>${details.title}`;
                modalBody.innerHTML = details.content;
                actionButton.innerHTML = `<i class="bi bi-arrow-right me-1"></i>${details.action}`;
                actionButton.onclick = () => {
                    // Handle action button click
                    closeNotificationModal();
                    showToast('Redirecionando...', 'info');
                };
            }
        }

        function closeNotificationModal() {
            const modal = document.getElementById('notificationModal');
            modal.style.display = 'none';
            modal.classList.remove('show');
        }

        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            toast.innerHTML = `
                <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function inscreverEdital() {
            showToast('Redirecionando para inscrição...', 'info');
            // Simulate redirect to edital inscription page
            setTimeout(() => {
                window.location.href = '/aluno/editais';
            }, 1500);
        }
    </script>
{% endblock %}