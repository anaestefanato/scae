{% extends 'base2.html' %}
{% set active_page = 'editais' %}

{% block title %}SCAE - Renovação{% endblock %}

{% block head %}
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/editais_primeira_inscricao_aluno.css">
{% endblock %}

{% block content %}
<div class="main-content" id="mainContent">
    <!-- Welcome Banner -->
    <div class="welcome-banner mb-4">
        <div class="row align-items-center">
            <div class="col-12">
                <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-arrow-clockwise text-success me-3" style="font-size: 2rem;"></i>
                    <h4 class="mb-0">Renovação do Auxílio Estudantil</h4>
                </div>
                <p>Revise seus dados e atualize as informações necessárias para continuar recebendo o auxílio estudantil.</p>
            </div>
        </div>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps mb-4">
        <div class="step active" id="step-1">
            <span>1</span>
            <div class="step-label">Dados</div>
        </div>
        <div class="step" id="step-2">
            <span>2</span>
            <div class="step-label">Auxílios</div>
        </div>
        <div class="step" id="step-3">
            <span>3</span>
            <div class="step-label">Documentos</div>
        </div>
        <div class="progress-line">
            <div class="progress-line-fill" id="progress-fill"></div>
        </div>
    </div>

    <!-- Information Card -->
    {% if not auxilios_atuais or auxilios_atuais|length == 0 %}
    <div class="alert alert-info mb-4 d-flex justify-content-between align-items-center">
        <div>
            <i class="bi bi-exclamation-circle me-2"></i>
            <strong>Não possui nenhum auxílio ativo?</strong> Esta página é para renovação de auxílios existentes.
        </div>
        <a href="/aluno/editais/primeira-inscricao" class="btn btn-primary">
            <i class="bi bi-pencil-square me-2"></i>Fazer Primeira Inscrição
        </a>
    </div>
    {% else %}
    <div class="info-card mb-4">
        <h6><i class="bi bi-info-circle me-2"></i>Informações sobre a Renovação</h6>
        <ul>
            <li>Revise seus dados cadastrais e atualize se necessário</li>
            <li>Selecione os auxílios que deseja continuar recebendo</li>
            <li>Você pode solicitar novos auxílios durante a renovação</li>
            <li>Mantenha seus documentos atualizados</li>
        </ul>
    </div>
    {% endif %}

    <!-- Form Container -->
    <div class="form-container">
        <div class="form-title">
            <i class="bi bi-arrow-clockwise"></i>
            Formulário de Renovação 2025
        </div>
        <p class="form-subtitle">
            Revise seus dados, selecione os auxílios e atualize os documentos necessários.
        </p>

        <form method="post" enctype="multipart/form-data" id="renovacaoForm">
            <!-- Etapa 1: Dados Cadastrais -->
            <div class="form-etapa" id="etapa-1" style="display: block;">
                <!-- Dados Pessoais -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="bi bi-person"></i>
                        Dados Pessoais
                    </div>
                    
                    <div class="form-row">
                        <div>
                            <label for="nome" class="form-label required-field">Nome Completo</label>
                            <input type="text" class="form-control" id="nome" name="nome" value="{{aluno.nome}}" readonly required>
                        </div>
                        <div>
                            <label for="cpf" class="form-label required-field">CPF</label>
                            <input type="text" class="form-control" id="cpf" name="cpf" value="{{aluno.cpf}}" readonly required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="data_nascimento" class="form-label required-field">Data de Nascimento</label>
                            <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" value="{{aluno.data_nascimento}}" readonly required>
                        </div>
                        <div>
                            <label for="telefone" class="form-label required-field">Telefone</label>
                            <input type="text" class="form-control" id="telefone" name="telefone" value="{{aluno.telefone}}" readonly required>
                        </div>
                    </div>

                    <div class="form-row single-column">
                        <div>
                            <label for="email" class="form-label required-field">E-mail</label>
                            <input type="email" class="form-control" id="email" name="email" value="{{aluno.email}}" readonly required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="logradouro" class="form-label required-field">Logradouro</label>
                            <input type="text" class="form-control" id="logradouro" name="logradouro" value="{{aluno.rua}}" readonly required>
                        </div>
                        <div>
                            <label for="numero" class="form-label required-field">Número</label>
                            <input type="text" class="form-control" id="numero" name="numero" value="{{aluno.numero}}" readonly required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="bairro" class="form-label required-field">Bairro</label>
                            <input type="text" class="form-control" id="bairro" name="bairro" value="{{aluno.bairro}}" readonly required>
                        </div>
                        <div>
                            <label for="cidade" class="form-label required-field">Cidade</label>
                            <input type="text" class="form-control" id="cidade" name="cidade" value="{{aluno.cidade}}" readonly required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="cep" class="form-label required-field">CEP</label>
                            <div class="input-group" style="height: 38px;">
                                <input type="text" class="form-control" id="cep" name="cep" placeholder="00000-000" maxlength="9" value="{{ aluno.cep if aluno and aluno.cep else '' }}" readonly required style="height: 38px;">
                                <button class="btn btn-outline-secondary" type="button" id="btn-buscar-cep" disabled style="height: 38px; padding: 0 12px;">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                            <div id="cep-loading" class="form-text text-primary" style="display: none;">
                                <i class="bi bi-hourglass-split"></i> Buscando CEP...
                            </div>
                            <div id="cep-error" class="form-text text-danger" style="display: none;">
                                <i class="bi bi-exclamation-triangle"></i> CEP não encontrado
                            </div>
                        </div>
                        <div>
                            <label for="estado" class="form-label required-field">Estado</label>
                            <input type="text" class="form-control" id="estado" name="estado" placeholder="Ex: ES" maxlength="2" value="{{ aluno.estado if aluno and aluno.estado else '' }}" readonly required>
                        </div>
                    </div>
                </div>

                <!-- Dados Acadêmicos -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="bi bi-mortarboard"></i>
                        Dados Acadêmicos
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="curso" class="form-label required-field">Curso</label>
                            <input type="text" class="form-control" id="curso" name="curso" value="{{ aluno.curso if aluno and aluno.curso else '' }}" readonly required>
                        </div>
                        <div>
                            <label for="matricula" class="form-label required-field">Matrícula</label>
                            <input type="text" class="form-control" id="matricula" name="matricula" value="{{ aluno.matricula if aluno and aluno.matricula else '' }}" readonly required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="ano_ingresso" class="form-label required-field">Ano de Ingresso</label>
                            <input type="number" class="form-control" id="ano_ingresso" name="ano_ingresso" value="{{ aluno.ano_ingresso if aluno and aluno.ano_ingresso else '' }}" min="2000" max="2030" readonly required>
                        </div>
                        <div>
                            <label for="ano_conclusao_previsto" class="form-label required-field">Ano Previsto para Conclusão</label>
                            <input type="number" class="form-control" id="ano_conclusao_previsto" name="ano_conclusao_previsto" value="{{ aluno.ano_conclusao_previsto if aluno and aluno.ano_conclusao_previsto else '' }}" min="2024" max="2035" readonly required>
                        </div>
                    </div>
                </div>

                <!-- Dados Financeiros -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="bi bi-cash-stack"></i>
                        Dados Financeiros
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="pessoas_residencia" class="form-label required-field">Pessoas na Residência</label>
                            <input type="number" class="form-control" id="pessoas_residencia" name="pessoas_residencia" value="{{ aluno.quantidade_pessoas if aluno and aluno.quantidade_pessoas else '' }}" readonly required>
                        </div>
                        <div>
                            <label for="renda_percapita" class="form-label required-field">Renda Familiar Per Capita</label>
                            <select class="form-control" id="renda_percapita" name="renda_percapita" disabled required>
                                <option value="menor_1" {% if aluno and aluno.renda_per_capita and aluno.renda_per_capita <= 1412 %}selected{% endif %}>Menor ou igual a 1 salário mínimo</option>
                                <option value="ate_1_5" {% if aluno and aluno.renda_per_capita and aluno.renda_per_capita > 1412 and aluno.renda_per_capita <= 2118 %}selected{% endif %}>Até 1,5 salário mínimo</option>
                                <option value="maior_1_5" {% if aluno and aluno.renda_per_capita and aluno.renda_per_capita > 2118 %}selected{% endif %}>Maior que 1,5 salário mínimo</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="bolsa_pesquisa" class="form-label required-field">Recebe Bolsa de Pesquisa?</label>
                            <select class="form-control" id="bolsa_pesquisa" name="bolsa_pesquisa" disabled required>
                                <option value="nao" {% if not aluno or not aluno.bolsa_pesquisa or aluno.bolsa_pesquisa == 'nao' %}selected{% endif %}>Não</option>
                                <option value="sim" {% if aluno and aluno.bolsa_pesquisa == 'sim' %}selected{% endif %}>Sim</option>
                            </select>
                        </div>
                        <div>
                            <label for="cad_unico" class="form-label required-field">Inscrito no CAD Único?</label>
                            <select class="form-control" id="cad_unico" name="cad_unico" disabled required>
                                <option value="sim" {% if aluno and aluno.cad_unico == 'sim' %}selected{% endif %}>Sim</option>
                                <option value="nao" {% if not aluno or not aluno.cad_unico or aluno.cad_unico == 'nao' %}selected{% endif %}>Não</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div>
                            <label for="bolsa_familia" class="form-label required-field">Recebe Bolsa Família?</label>
                            <select class="form-control" id="bolsa_familia" name="bolsa_familia" disabled required>
                                <option value="nao" {% if not aluno or not aluno.bolsa_familia or aluno.bolsa_familia == 'nao' %}selected{% endif %}>Não</option>
                                <option value="sim" {% if aluno and aluno.bolsa_familia == 'sim' %}selected{% endif %}>Sim</option>
                            </select>
                        </div>
                        <div></div>
                    </div>
                </div>
            </div>
            <!-- Fim Etapa 1 -->

            <!-- Etapa 2: Auxílios -->
            <div class="form-etapa" id="etapa-2" style="display: none;">
                <!-- Auxílios Atuais -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="bi bi-check-circle"></i>
                        Auxílios que Você Recebe Atualmente
                    </div>
                    
                    <div class="alert alert-success">
                        <i class="bi bi-info-circle me-2"></i>
                        Selecione os auxílios que deseja <strong>continuar recebendo</strong> na renovação.
                    </div>

                    <div class="form-row single-column">
                        <div>
                            <label class="form-label required-field">Renovar auxílios:</label>
                            <div class="checkbox-group">
                                {% if 'alimentacao' in auxilios_atuais %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="renovar_alimentacao" name="renovar_auxilios" value="alimentacao" checked>
                                    <label class="form-check-label" for="renovar_alimentacao">
                                        <i class="bi bi-egg-fried text-warning me-2"></i>
                                        <strong>Auxílio Alimentação</strong> - R$ 600,00/mês
                                        <span class="badge bg-success ms-2">Recebendo</span>
                                    </label>
                                </div>
                                {% endif %}
                                
                                {% if 'transporte' in auxilios_atuais %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="renovar_transporte" name="renovar_auxilios" value="transporte" checked onchange="toggleDocumentosTransporteRenovacao()">
                                    <label class="form-check-label" for="renovar_transporte">
                                        <i class="bi bi-bus-front text-success me-2"></i>
                                        <strong>Auxílio Transporte</strong> - R$ 300,00/mês
                                        <span class="badge bg-success ms-2">Recebendo</span>
                                    </label>
                                </div>
                                {% endif %}
                                
                                {% if 'moradia' in auxilios_atuais %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="renovar_moradia" name="renovar_auxilios" value="moradia" checked>
                                    <label class="form-check-label" for="renovar_moradia">
                                        <i class="bi bi-house-door text-primary me-2"></i>
                                        <strong>Auxílio Moradia</strong> - R$ 400,00/mês
                                        <span class="badge bg-success ms-2">Recebendo</span>
                                    </label>
                                </div>
                                {% endif %}
                                
                                {% if 'material' in auxilios_atuais %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="renovar_material" name="renovar_auxilios" value="material" checked>
                                    <label class="form-check-label" for="renovar_material">
                                        <i class="bi bi-book text-info me-2"></i>
                                        <strong>Auxílio Material Didático</strong> - R$ 200,00/semestre
                                        <span class="badge bg-success ms-2">Recebendo</span>
                                    </label>
                                </div>
                                {% endif %}
                                
                                {% if not auxilios_atuais or auxilios_atuais|length == 0 %}
                                <div class="alert alert-warning">
                                    <i class="bi bi-exclamation-triangle me-2"></i>
                                    Você não possui auxílios ativos no momento. Selecione os auxílios que deseja solicitar na seção "Solicitar Novos Auxílios" abaixo.
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Perguntas de Transporte (se renovado) -->
                <div class="form-section" id="perguntas-transporte-renovacao" style="{% if 'transporte' in auxilios_atuais %}display: block;{% else %}display: none;{% endif %}">
                    <div class="section-title">
                        <i class="bi bi-question-circle"></i>
                        Informações sobre Transporte
                    </div>
                    
                    <div class="form-row single-column">
                        <div>
                            <label class="form-label required-field">Tipo de transporte atual:</label>
                            <div class="radio-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="transporte_van_renovacao" name="tipo_transporte_renovacao" value="van" {% if auxilio_transporte and auxilio_transporte.tipo_transporte == 'van' %}checked{% endif %} onchange="toggleTipoTransporteRenovacao()">
                                    <label class="form-check-label" for="transporte_van_renovacao">
                                        <i class="bi bi-minecart text-primary me-2"></i>
                                        <strong>Van Escolar</strong>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" id="transporte_onibus_renovacao" name="tipo_transporte_renovacao" value="onibus" {% if not auxilio_transporte or auxilio_transporte.tipo_transporte == 'onibus' %}checked{% endif %} onchange="toggleTipoTransporteRenovacao()">
                                    <label class="form-check-label" for="transporte_onibus_renovacao">
                                        <i class="bi bi-bus-front text-success me-2"></i>
                                        <strong>Ônibus</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row single-column" id="opcoes-onibus-renovacao" style="{% if not auxilio_transporte or auxilio_transporte.tipo_transporte == 'onibus' %}display: block;{% else %}display: none;{% endif %}">
                        <div>
                            <label class="form-label required-field">Tipo de ônibus:</label>
                            <div class="checkbox-group">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="onibus_municipal_renovacao" name="tipo_onibus_renovacao" value="municipal" {% if auxilio_transporte and auxilio_transporte.tipo_onibus and 'municipal' in auxilio_transporte.tipo_onibus %}checked{% endif %}>
                                    <label class="form-check-label" for="onibus_municipal_renovacao">
                                        <i class="bi bi-building text-info me-2"></i>
                                        <strong>Ônibus Municipal</strong>
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="onibus_intermunicipal_renovacao" name="tipo_onibus_renovacao" value="intermunicipal" {% if auxilio_transporte and auxilio_transporte.tipo_onibus and 'intermunicipal' in auxilio_transporte.tipo_onibus %}checked{% endif %}>
                                    <label class="form-check-label" for="onibus_intermunicipal_renovacao">
                                        <i class="bi bi-signpost-2 text-warning me-2"></i>
                                        <strong>Ônibus Intermunicipal</strong>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-row single-column" id="gasto-onibus-renovacao" style="{% if not auxilio_transporte or auxilio_transporte.tipo_transporte == 'onibus' %}display: block;{% else %}display: none;{% endif %}">
                        <div>
                            <label for="gasto_passagens_dia_renovacao" class="form-label required-field">Gasto com passagens (ida e volta):</label>
                            <div class="input-group" style="max-width: 500px; height: 45px;">
                                <span class="input-group-text" style="min-width: 50px; height: 45px; display: flex; align-items: center; justify-content: center;">R$</span>
                                <input type="number" class="form-control" id="gasto_passagens_dia_renovacao" name="gasto_passagens_dia_renovacao" value="{{ auxilio_transporte.gasto_passagens_dia if auxilio_transporte and auxilio_transporte.gasto_passagens_dia else '' }}" step="0.01" min="0" style="height: 45px;">
                            </div>
                        </div>
                    </div>

                    <div class="form-row single-column" id="gasto-van-renovacao" style="{% if auxilio_transporte and auxilio_transporte.tipo_transporte == 'van' %}display: block;{% else %}display: none;{% endif %}">
                        <div>
                            <label for="gasto_van_mensal_renovacao" class="form-label required-field">Gasto mensal com van:</label>
                            <div class="input-group" style="max-width: 500px; height: 45px;">
                                <span class="input-group-text" style="min-width: 50px; height: 45px; display: flex; align-items: center; justify-content: center;">R$</span>
                                <input type="number" class="form-control" id="gasto_van_mensal_renovacao" name="gasto_van_mensal_renovacao" value="{{ auxilio_transporte.gasto_van_mensal if auxilio_transporte and auxilio_transporte.gasto_van_mensal else '' }}" step="0.01" min="0" style="height: 45px;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Solicitar Novos Auxílios -->
                <div class="form-section">
                    <div class="section-title">
                        <i class="bi bi-plus-circle"></i>
                        Solicitar Novos Auxílios
                    </div>
                    
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        Selecione se deseja <strong>receber novos auxílios</strong> que você ainda não possui.
                    </div>

                    <div class="form-row single-column">
                        <div>
                            <label class="form-label">Novos auxílios (opcional):</label>
                            <div class="checkbox-group">
                                {% if 'alimentacao' not in auxilios_atuais %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="novo_alimentacao" name="novos_auxilios" value="alimentacao">
                                    <label class="form-check-label" for="novo_alimentacao">
                                        <i class="bi bi-egg-fried text-warning me-2"></i>
                                        <strong>Auxílio Alimentação</strong> - R$ 600,00/mês
                                    </label>
                                </div>
                                {% endif %}
                                
                                {% if 'moradia' not in auxilios_atuais %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="novo_moradia" name="novos_auxilios" value="moradia" onchange="toggleDocumentosMoradiaRenovacao()">
                                    <label class="form-check-label" for="novo_moradia">
                                        <i class="bi bi-house-door text-primary me-2"></i>
                                        <strong>Auxílio Moradia</strong> - R$ 400,00/mês
                                    </label>
                                </div>
                                {% endif %}
                                
                                {% if 'transporte' not in auxilios_atuais %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="novo_transporte" name="novos_auxilios" value="transporte" onchange="toggleDocumentosTransporteNovoRenovacao()">
                                    <label class="form-check-label" for="novo_transporte">
                                        <i class="bi bi-bus-front text-success me-2"></i>
                                        <strong>Auxílio Transporte</strong> - R$ 300,00/mês
                                    </label>
                                </div>
                                {% endif %}
                                
                                {% if 'material' not in auxilios_atuais %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="novo_material" name="novos_auxilios" value="material">
                                    <label class="form-check-label" for="novo_material">
                                        <i class="bi bi-book text-info me-2"></i>
                                        <strong>Auxílio Material Didático</strong> - R$ 200,00/semestre
                                    </label>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documentação para Novo Auxílio Moradia -->
                <div class="form-section" id="docs-moradia-novo" style="display: none;">
                    <div class="section-title">
                        <i class="bi bi-file-earmark-text"></i>
                        Documentação - Novo Auxílio Moradia
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="comprovante_residencia_anterior_novo" class="form-label required-field">Comprovante de Residência Anterior</label>
                            <input type="file" class="form-control" id="comprovante_residencia_anterior_novo" name="comprovante_residencia_anterior_novo" accept="application/pdf">
                        </div>
                        <div>
                            <label for="comprovante_residencia_atual_novo" class="form-label required-field">Comprovante de Residência Atual</label>
                            <input type="file" class="form-control" id="comprovante_residencia_atual_novo" name="comprovante_residencia_atual_novo" accept="application/pdf">
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="contrato_aluguel_atual_novo" class="form-label required-field">Contrato de Aluguel Atual</label>
                            <input type="file" class="form-control" id="contrato_aluguel_atual_novo" name="contrato_aluguel_atual_novo" accept="application/pdf">
                        </div>
                        <div></div>
                    </div>
                </div>
            </div>
            <!-- Fim Etapa 2 -->

            <!-- Etapa 3: Documentos -->
            <div class="form-etapa" id="etapa-3" style="display: none;">
                <div class="form-section">
                    <div class="section-title">
                        <i class="bi bi-cloud-upload"></i>
                        Documentos Obrigatórios
                    </div>

                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Atenção:</strong> Os documentos abaixo já foram enviados anteriormente. Você pode mantê-los ou enviar versões atualizadas.
                    </div>

                    <div class="form-row single-column">
                        <div>
                            <label for="anexo_documentos_renovacao" class="form-label">Documento de Identificação</label>
                            <div class="mb-2">
                                <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Arquivo enviado: documento_identidade.pdf</span>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="habilitarEnvioDoc('anexo_documentos_renovacao')">
                                    <i class="bi bi-pencil me-1"></i>Atualizar
                                </button>
                            </div>
                            <input type="file" class="form-control" id="anexo_documentos_renovacao" name="anexo_documentos_renovacao" accept="application/pdf" disabled>
                            <div class="file-upload-helper">
                                <i class="bi bi-info-circle"></i>
                                Documento de identificação (PDF, máx. 10MB)
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div>
                            <label for="anexo_1_renovacao" class="form-label">Anexo I - Declaração de Renda</label>
                            <div class="mb-2">
                                <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Arquivo enviado: anexo_1.pdf</span>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="habilitarEnvioDoc('anexo_1_renovacao')">
                                    <i class="bi bi-pencil me-1"></i>Atualizar
                                </button>
                            </div>
                            <input type="file" class="form-control" id="anexo_1_renovacao" name="anexo_1_renovacao" accept="application/pdf" disabled>
                        </div>
                        <div>
                            <label for="anexo_3_renovacao" class="form-label">Anexo III - Termo de Responsabilidade</label>
                            <div class="mb-2">
                                <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Arquivo enviado: anexo_3.pdf</span>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="habilitarEnvioDoc('anexo_3_renovacao')">
                                    <i class="bi bi-pencil me-1"></i>Atualizar
                                </button>
                            </div>
                            <input type="file" class="form-control" id="anexo_3_renovacao" name="anexo_3_renovacao" accept="application/pdf" disabled>
                        </div>
                    </div>

                    <!-- Documentos específicos de transporte -->
                    <div id="docs-transporte-existente">
                        <h6 class="mt-4 mb-3"><i class="bi bi-bus-front me-2"></i>Documentos do Auxílio Transporte</h6>
                        <div class="form-row single-column">
                            <div>
                                <label for="comprovante_residencia_transporte_renovacao" class="form-label">Comprovante de Residência (Transporte)</label>
                                <div class="mb-2">
                                    <span class="badge bg-success"><i class="bi bi-check-circle me-1"></i>Arquivo enviado: comprovante_residencia_transp.pdf</span>
                                    <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="habilitarEnvioDoc('comprovante_residencia_transporte_renovacao')">
                                        <i class="bi bi-pencil me-1"></i>Atualizar
                                    </button>
                                </div>
                                <input type="file" class="form-control" id="comprovante_residencia_transporte_renovacao" name="comprovante_residencia_transporte_renovacao" accept="application/pdf" disabled>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Fim Etapa 3 -->

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" id="btn-voltar" onclick="voltarEtapa()" style="display: none;">
                    <i class="bi bi-arrow-left me-2"></i>Voltar
                </button>
                <button type="button" class="btn btn-primary" id="btn-proxima" onclick="proximaEtapa()">
                    <i class="bi bi-arrow-right me-2"></i>Próxima Etapa
                </button>
                <button type="submit" class="btn btn-success" id="btn-enviar" style="display: none;">
                    <i class="bi bi-check-circle me-2"></i>Confirmar Renovação
                </button>
            </div>
        </form>
    </div>

    <!-- Information Cards -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-calendar-check me-2"></i>Cronograma
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><i class="bi bi-circle-fill text-success me-2" style="font-size: 0.5rem;"></i>Renovação: <strong>01/02 a 28/02/2025</strong></li>
                        <li><i class="bi bi-circle-fill text-warning me-2" style="font-size: 0.5rem;"></i>Análise: <strong>01/03 a 14/03/2025</strong></li>
                        <li><i class="bi bi-circle-fill text-info me-2" style="font-size: 0.5rem;"></i>Resultado: <strong>15/03/2025</strong></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <i class="bi bi-headset me-2"></i>Precisa de Ajuda?
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><i class="bi bi-envelope text-primary me-2"></i>assistencia.estudantil@ifes.edu.br</li>
                        <li><i class="bi bi-telephone text-primary me-2"></i>(27) 3333-2222</li>
                        <li><i class="bi bi-whatsapp text-success me-2"></i>(27) 99999-8888</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let etapaAtual = 1;
let camposEditaveis = {
    pessoais: false,
    academicos: false,
    financeiros: false
};

function atualizarBarraProgresso() {
    const progressFill = document.getElementById('progress-fill');
    let porcentagem;
    if (etapaAtual === 1) {
        porcentagem = 0;
    } else if (etapaAtual === 2) {
        porcentagem = 50;
    } else if (etapaAtual === 3) {
        porcentagem = 100;
    }
    progressFill.style.width = porcentagem + '%';
}

function proximaEtapa() {
    if (etapaAtual < 3) {
        document.getElementById('etapa-' + etapaAtual).style.display = 'none';
        document.getElementById('step-' + etapaAtual).classList.remove('active');
        document.getElementById('step-' + etapaAtual).classList.add('completed');
        
        etapaAtual++;
        
        document.getElementById('etapa-' + etapaAtual).style.display = 'block';
        document.getElementById('step-' + etapaAtual).classList.add('active');
        
        atualizarBarraProgresso();
        
        document.getElementById('btn-voltar').style.display = 'inline-block';
        
        if (etapaAtual === 3) {
            document.getElementById('btn-proxima').style.display = 'none';
            document.getElementById('btn-enviar').style.display = 'inline-block';
        }
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function voltarEtapa() {
    if (etapaAtual > 1) {
        document.getElementById('etapa-' + etapaAtual).style.display = 'none';
        document.getElementById('step-' + etapaAtual).classList.remove('active');
        document.getElementById('step-' + etapaAtual).classList.remove('completed');
        
        etapaAtual--;
        
        document.getElementById('etapa-' + etapaAtual).style.display = 'block';
        document.getElementById('step-' + etapaAtual).classList.add('active');
        document.getElementById('step-' + etapaAtual).classList.remove('completed');
        
        atualizarBarraProgresso();
        
        if (etapaAtual === 1) {
            document.getElementById('btn-voltar').style.display = 'none';
        }
        
        document.getElementById('btn-proxima').style.display = 'inline-block';
        document.getElementById('btn-enviar').style.display = 'none';
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function habilitarEdicao(secao) {
    camposEditaveis[secao] = true;
    document.getElementById('alert-edit-mode').style.display = 'block';
    
    const campos = {
        'pessoais': ['nome', 'cpf', 'data_nascimento', 'telefone', 'email', 'logradouro', 'numero', 'bairro', 'cidade', 'cep', 'estado'],
        'academicos': ['curso', 'matricula', 'ano_ingresso', 'ano_conclusao_previsto'],
        'financeiros': ['pessoas_residencia']
    };
    
    const selects = {
        'financeiros': ['renda_percapita', 'bolsa_pesquisa', 'cad_unico']
    };
    
    if (campos[secao]) {
        campos[secao].forEach(campo => {
            const element = document.getElementById(campo);
            if (element) {
                element.removeAttribute('readonly');
                element.classList.add('border-warning');
            }
        });
    }
    
    if (selects[secao]) {
        selects[secao].forEach(campo => {
            const element = document.getElementById(campo);
            if (element) {
                element.removeAttribute('disabled');
                element.classList.add('border-warning');
            }
        });
    }
    
    // Habilitar botão de busca CEP se for seção pessoais
    if (secao === 'pessoais') {
        const btnBuscarCep = document.getElementById('btn-buscar-cep');
        const cepInput = document.getElementById('cep');
        if (btnBuscarCep && cepInput && cepInput.value.replace(/\D/g, '').length === 8) {
            btnBuscarCep.disabled = false;
        }
    }
    
    document.getElementById('btn-editar-' + secao).style.display = 'none';
}

function cancelarEdicao() {
    Object.keys(camposEditaveis).forEach(secao => {
        if (camposEditaveis[secao]) {
            // Reativa botão de edição
            document.getElementById('btn-editar-' + secao).style.display = 'inline-block';
            camposEditaveis[secao] = false;
        }
    });
    
    document.getElementById('alert-edit-mode').style.display = 'none';
    
    // Recarrega a página para restaurar valores originais
    location.reload();
}

function toggleDocumentosTransporteRenovacao() {
    const checkbox = document.getElementById('renovar_transporte');
    const perguntasSection = document.getElementById('perguntas-transporte-renovacao');
    
    if (checkbox.checked) {
        perguntasSection.style.display = 'block';
    } else {
        perguntasSection.style.display = 'none';
    }
}

function toggleTipoTransporteRenovacao() {
    const vanRadio = document.getElementById('transporte_van_renovacao');
    const onibusRadio = document.getElementById('transporte_onibus_renovacao');
    const opcoesOnibus = document.getElementById('opcoes-onibus-renovacao');
    const gastoOnibus = document.getElementById('gasto-onibus-renovacao');
    const gastoVan = document.getElementById('gasto-van-renovacao');
    
    if (vanRadio.checked) {
        gastoVan.style.display = 'block';
        opcoesOnibus.style.display = 'none';
        gastoOnibus.style.display = 'none';
        document.querySelectorAll('input[name="tipo_onibus_renovacao"]').forEach(checkbox => checkbox.checked = false);
    } else if (onibusRadio.checked) {
        opcoesOnibus.style.display = 'block';
        gastoOnibus.style.display = 'block';
        gastoVan.style.display = 'none';
    }
}

function toggleDocumentosMoradiaRenovacao() {
    const checkbox = document.getElementById('novo_moradia');
    const docsSection = document.getElementById('docs-moradia-novo');
    
    if (checkbox.checked) {
        docsSection.style.display = 'block';
    } else {
        docsSection.style.display = 'none';
    }
}

function habilitarEnvioDoc(fieldId) {
    const field = document.getElementById(fieldId);
    if (field) {
        field.removeAttribute('disabled');
        field.classList.add('border-warning');
        // Oculta o botão de atualizar
        event.target.style.display = 'none';
    }
}

// Busca de CEP usando ViaCEP
function buscarCEP() {
    const cep = document.getElementById('cep').value.replace(/\D/g, '');
    
    if (cep.length !== 8) {
        return;
    }
    
    const btnBuscar = document.getElementById('btn-buscar-cep');
    const cepLoading = document.getElementById('cep-loading');
    const cepError = document.getElementById('cep-error');
    
    // Mostrar loading
    btnBuscar.disabled = true;
    cepLoading.style.display = 'block';
    cepError.style.display = 'none';
    
    // Buscar CEP na API ViaCEP
    fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(response => response.json())
        .then(data => {
            cepLoading.style.display = 'none';
            btnBuscar.disabled = false;
            
            if (data.erro) {
                cepError.style.display = 'block';
                return;
            }
            
            // Preencher campos automaticamente
            document.getElementById('logradouro').value = data.logradouro || '';
            document.getElementById('bairro').value = data.bairro || '';
            document.getElementById('cidade').value = data.localidade || '';
            document.getElementById('estado').value = data.uf || '';
            
            // Focar no campo número
            document.getElementById('numero').focus();
        })
        .catch(error => {
            console.error('Erro ao buscar CEP:', error);
            cepLoading.style.display = 'none';
            cepError.style.display = 'block';
            btnBuscar.disabled = false;
        });
}

// Formatar CEP enquanto digita
function formatarCEP(input) {
    let valor = input.value.replace(/\D/g, '');
    
    if (valor.length > 8) {
        valor = valor.substring(0, 8);
    }
    
    if (valor.length > 5) {
        valor = valor.replace(/(\d{5})(\d)/, '$1-$2');
    }
    
    input.value = valor;
    
    // Habilitar/desabilitar botão de busca
    const btnBuscar = document.getElementById('btn-buscar-cep');
    if (valor.replace(/\D/g, '').length === 8 && !input.hasAttribute('readonly')) {
        btnBuscar.disabled = false;
    } else {
        btnBuscar.disabled = true;
    }
}

// Inicializar
document.addEventListener('DOMContentLoaded', function() {
    atualizarBarraProgresso();
    
    // Event listeners para CEP
    const cepInput = document.getElementById('cep');
    const btnBuscarCep = document.getElementById('btn-buscar-cep');
    
    if (cepInput) {
        cepInput.addEventListener('input', function() {
            formatarCEP(this);
        });
        
        cepInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                buscarCEP();
            }
        });
    }
    
    if (btnBuscarCep) {
        btnBuscarCep.addEventListener('click', buscarCEP);
    }
});
</script>
{% endblock %}
