<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCAE - Gerenciamento de Editais</title>
    <link rel="icon" type="image/png" href="/static/img/logo.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/dashboard_assistente.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Garantir que os campos de data fiquem com texto visível */
        input[type="date"] {
            color: #495057;
            color-scheme: light;
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 1;
            cursor: pointer;
        }
        input[type="date"]:focus {
            color: #495057;
        }
    </style>
</head>
<body>
    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menuToggle">
        <i class="bi bi-list"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="close-sidebar" id="closeSidebar">
                <i class="bi bi-x-lg"></i>
            </button>
            <img src="/static/img/logoifes.png" alt="Logo IFES" width="180">
        </div>
        <div class="d-flex flex-column p-3">
            <div class="mb-4 text-center">
                <h6 class="mb-0">Sistema de Controle de</h6>
                <h6>Assistência Estudantil</h6>
            </div>
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a href="/assistente/inicio" class="nav-link">
                        <i class="bi bi-speedometer2"></i> <span>Início</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/agenda" class="nav-link">
                        <i class="bi bi-calendar-event"></i> <span>Agenda</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/alunos" class="nav-link">
                        <i class="bi bi-people"></i> <span>Alunos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/analise-inscricoes" class="nav-link">
                        <i class="bi bi-clipboard-check"></i> <span>Análise de Inscrições</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/analise-recursos" class="nav-link">
                        <i class="bi bi-journal-text"></i> <span>Análise de Recursos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/editais" class="nav-link active bg-success">
                        <i class="bi bi-file-earmark-ruled"></i> <span>Editais</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/entrevistas" class="nav-link">
                        <i class="bi bi-file-earmark-text"></i> <span>Entrevistas Agendadas</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/mensagens" class="nav-link">
                        <i class="bi bi-envelope"></i> <span>Mensagens</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/perfil" class="nav-link">
                        <i class="bi bi-person-circle"></i> <span>Meu Perfil</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/relatorios" class="nav-link">
                        <i class="bi bi-file-earmark-bar-graph"></i> <span>Relatórios</span>
                    </a>
                </li>
            </ul>
            <hr>
            <div class="text-center">
                <a href="#" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#logoutModal">
                    <i class="bi bi-box-arrow-right"></i> <span>Sair</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="welcome-banner mb-4 card-hover">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 class="mb-3">Gerenciamento de Editais</h4>
                    <p>Publique e gerencie editais gerais, cronogramas, anexos e resultados do programa de assistência estudantil.</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#novoEditalModal">
                        <i class="bi bi-file-earmark-plus me-2"></i>Novo Documento
                    </button>
                </div>
            </div>
        </div>

        <!-- Mensagens de sucesso/erro -->
        {% if request.query_params.get('sucesso') %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle-fill me-2"></i>{{ request.query_params.get('sucesso') }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        {% if request.query_params.get('erro') %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>{{ request.query_params.get('erro') }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-calendar-fill me-2"></i>Editais 2025</h5>
                    </div>
                    <div class="card-body">
                        <!-- Editais Gerais do Ano -->
                        <div class="mb-4">
                            <h6 class="text-success mb-3"><i class="bi bi-folder-fill me-2"></i>Editais Gerais 2025</h6>
                            <div class="editais-list">
                                <div class="d-flex justify-content-between align-items-center mb-2 p-3 bg-light rounded">
                                    <div>
                                        <h6 class="mb-1"><i class="bi bi-file-earmark-pdf text-danger me-2"></i>Edital - Programa de Assistência Estudantil 001/2025</h6>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary me-2" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info me-2" title="Baixar">
                                            <i class="bi bi-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-2" title="Substituir">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-2 p-3 bg-light rounded">
                                    <div>
                                        <h6 class="mb-1"><i class="bi bi-file-earmark-pdf text-danger me-2"></i>Cronograma - Programa de Assistência Estudantil 2025</h6>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary me-2" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info me-2" title="Baixar">
                                            <i class="bi bi-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-2" title="Substituir">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center p-3 bg-light rounded">
                                    <div>
                                        <h6 class="mb-2"><i class="bi bi-files text-primary me-2"></i>Anexos para Inscrição</h6>
                                        <ul class="list-unstyled mb-0 small">
                                            <li class="mb-2">
                                                <span class="fw-semibold">Anexo I - Formulário Socioeconômico</span>
                                                <div class="mt-1">
                                                    <a class="btn btn-sm btn-outline-primary me-2" href="/static/docs/2025/ANEXO_I_2025.pdf" target="_blank" title="Visualizar Anexo I">
                                                        <i class="bi bi-eye"></i> Visualizar
                                                    </a>
                                                    <a class="btn btn-sm btn-outline-info" href="/static/docs/2025/ANEXO_I_2025.pdf" download title="Baixar Anexo I">
                                                        <i class="bi bi-download"></i> Baixar
                                                    </a>
                                                </div>
                                            </li>
                                            <li class="mb-2">
                                                <span class="fw-semibold">Anexo V - Declaração de Composição Familiar</span>
                                                <div class="mt-1">
                                                    <a class="btn btn-sm btn-outline-primary me-2" href="/static/docs/2025/ANEXO_V_2025.pdf" target="_blank" title="Visualizar Anexo V">
                                                        <i class="bi bi-eye"></i> Visualizar
                                                    </a>
                                                    <a class="btn btn-sm btn-outline-info" href="/static/docs/2025/ANEXO_V_2025.pdf" download title="Baixar Anexo V">
                                                        <i class="bi bi-download"></i> Baixar
                                                    </a>
                                                </div>
                                            </li>
                                            <li>
                                                <span class="fw-semibold">Anexo VI - Termo de Compromisso</span>
                                                <div class="mt-1">
                                                    <a class="btn btn-sm btn-outline-primary me-2" href="/static/docs/2025/ANEXO_VI_2025.pdf" target="_blank" title="Visualizar Anexo VI">
                                                        <i class="bi bi-eye"></i> Visualizar
                                                    </a>
                                                    <a class="btn btn-sm btn-outline-info" href="/static/docs/2025/ANEXO_VI_2025.pdf" download title="Baixar Anexo VI">
                                                        <i class="bi bi-download"></i> Baixar
                                                    </a>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="mt-3 mt-md-0">
                                        <button class="btn btn-sm btn-outline-warning" title="Gerenciar Anexos">
                                            <i class="bi bi-gear"></i> Gerenciar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <!-- Editais de Resultados -->
                        <div>
                            <h6 class="text-primary mb-3"><i class="bi bi-file-text-fill me-2"></i>Editais de Resultados</h6>
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="filtroSemestre" class="form-label fw-bold">Semestre</label>
                                    <select class="form-select" id="filtroSemestre">
                                        <option value="1">1º Semestre</option>
                                        <option value="2" selected>2º Semestre</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="tipoInscricao" class="form-label fw-bold">Tipo de Inscrição</label>
                                    <select class="form-select" id="tipoInscricao">
                                        <option value="primeira" selected>1ª Participação</option>
                                        <option value="atualizacao">Atualização</option>
                                        <option value="renovacao">Renovação</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="editais-list" id="resultadosLista">
                                <div class="d-flex justify-content-between align-items-center mb-2 p-3 bg-light rounded">
                                    <div>
                                        <h6 class="mb-1"><i class="bi bi-file-earmark-pdf text-danger me-2"></i>Resultado Preliminar - 1ª Participação</h6>
                                        <small class="text-muted">Publicado em: 20/09/2025 | 2º Semestre</small>
                                        <br>
                                        <span class="badge bg-warning text-dark mt-1">Preliminar</span>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary me-2" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info me-2" title="Baixar">
                                            <i class="bi bi-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-2" title="Substituir">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center p-3 bg-light rounded">
                                    <div>
                                        <h6 class="mb-1"><i class="bi bi-file-earmark-pdf text-danger me-2"></i>Resultado Final - 1ª Participação</h6>
                                        <small class="text-muted">Publicado em: 05/10/2025 | 2º Semestre</small>
                                        <br>
                                        <span class="badge bg-success mt-1">Final</span>
                                    </div>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary me-2" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info me-2" title="Baixar">
                                            <i class="bi bi-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning me-2" title="Substituir">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Novo Edital/Documento -->
    <div class="modal fade" id="novoEditalModal" tabindex="-1" aria-labelledby="novoEditalModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="novoEditalModalLabel">
                        <i class="bi bi-file-earmark-plus me-2"></i>Publicar Novo Documento
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Área para mensagens de erro do servidor -->
                    <div id="erroModalContainer"></div>
                    
                    <form id="novoEditalForm" method="post" action="/assistente/editais/publicar" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="tituloDocumento" class="form-label">
                                <i class="bi bi-type me-1"></i>Título do Edital
                            </label>
                            <input type="text" class="form-control" id="tituloDocumento" name="titulo" placeholder="Ex: Edital - Programa de Assistência Estudantil 001/2025" required>
                        </div>
                        
                        <!-- Período de Inscrição -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="dataInicioInscricao" class="form-label">
                                        <i class="bi bi-calendar-check me-1"></i>Início do Período de Inscrição
                                    </label>
                                    <input type="date" class="form-control" id="dataInicioInscricao" name="data_inicio_inscricao" placeholder="Ex: 01/11/2025" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="dataFimInscricao" class="form-label">
                                        <i class="bi bi-calendar-x me-1"></i>Fim do Período de Inscrição
                                    </label>
                                    <input type="date" class="form-control" id="dataFimInscricao" name="data_fim_inscricao" placeholder="Ex: 30/11/2025" required>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Período de Vigência dos Auxílios -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="dataInicioVigencia" class="form-label">
                                        <i class="bi bi-calendar-event me-1"></i>Início da Vigência dos Auxílios
                                    </label>
                                    <input type="date" class="form-control" id="dataInicioVigencia" name="data_inicio_vigencia" placeholder="Ex: 01/01/2026" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="dataFimVigencia" class="form-label">
                                        <i class="bi bi-calendar-range me-1"></i>Fim da Vigência dos Auxílios
                                    </label>
                                    <input type="date" class="form-control" id="dataFimVigencia" name="data_fim_vigencia" placeholder="Ex: 30/06/2026" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="dataPublicacao" class="form-label">
                                <i class="bi bi-calendar-event me-1"></i>Data de Publicação do Edital
                            </label>
                            <input type="date" class="form-control" id="dataPublicacao" name="data_publicacao" placeholder="Ex: 22/10/2025" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="arquivoDocumento" class="form-label">
                                <i class="bi bi-file-pdf me-1"></i>Arquivo do Edital (PDF)
                            </label>
                            <input type="file" class="form-control" id="arquivoDocumento" name="arquivo" accept=".pdf" placeholder="Selecione o arquivo PDF do edital" required>
                            <small class="text-muted">Clique para selecionar o arquivo PDF do edital (máximo 10MB)</small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="descricaoDocumento" class="form-label">
                                <i class="bi bi-card-text me-1"></i>Descrição do Edital
                            </label>
                            <textarea class="form-control" id="descricaoDocumento" name="descricao" rows="3" placeholder="Ex: Edital para seleção de estudantes ao Programa de Assistência Estudantil do 1º semestre de 2026" required></textarea>
                        </div>
                    </form>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cancelar
                    </button>
                    <button type="submit" form="novoEditalForm" class="btn btn-success">
                        <i class="bi bi-check-circle me-1"></i>Publicar Documento
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer bg-success text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="text-white mb-0">
                        &copy; 2025 Sistema de Controle de Assistência Estudantil. Todos os direitos reservados.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal de Confirmação de Logout -->
    <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logoutModalLabel">
                        <i class="bi bi-exclamation-triangle text-warning me-2"></i>Confirmar Saída
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Tem certeza que deseja sair do sistema?</p>
                    <div class="alert alert-info mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        Você precisará fazer login novamente para acessar o sistema.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cancelar
                    </button>
                    <a href="/logout" class="btn btn-danger">
                        <i class="bi bi-box-arrow-right me-1"></i>Confirmar Saída
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/dashboard_assistente.js"></script>
    <script>
        // Detectar se deve abrir o modal com dados preenchidos
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const deveAbrirModal = urlParams.get('modal');
            const erro = urlParams.get('erro');
            
            if (deveAbrirModal === 'abrir') {
                // Esconder o alerta de erro do topo da página
                const alertaTopo = document.querySelector('.alert-danger');
                if (alertaTopo) {
                    alertaTopo.style.display = 'none';
                }
                
                // Preencher os campos com os valores da URL
                const titulo = urlParams.get('titulo');
                const descricao = urlParams.get('descricao');
                const dataPublicacao = urlParams.get('data_publicacao');
                const dataInicioInscricao = urlParams.get('data_inicio_inscricao');
                const dataFimInscricao = urlParams.get('data_fim_inscricao');
                const dataInicioVigencia = urlParams.get('data_inicio_vigencia');
                const dataFimVigencia = urlParams.get('data_fim_vigencia');
                
                if (titulo) document.getElementById('tituloDocumento').value = decodeURIComponent(titulo);
                if (descricao) document.getElementById('descricaoDocumento').value = decodeURIComponent(descricao);
                if (dataPublicacao) document.getElementById('dataPublicacao').value = dataPublicacao;
                if (dataInicioInscricao) document.getElementById('dataInicioInscricao').value = dataInicioInscricao;
                if (dataFimInscricao) document.getElementById('dataFimInscricao').value = dataFimInscricao;
                if (dataInicioVigencia) document.getElementById('dataInicioVigencia').value = dataInicioVigencia;
                if (dataFimVigencia) document.getElementById('dataFimVigencia').value = dataFimVigencia;
                
                // Mostrar erro dentro do modal se houver
                if (erro) {
                    const erroContainer = document.getElementById('erroModalContainer');
                    const alertDiv = document.createElement('div');
                    alertDiv.className = 'alert alert-danger alert-dismissible fade show mb-3';
                    alertDiv.innerHTML = `
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <strong>Erro:</strong> ${decodeURIComponent(erro)}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    erroContainer.appendChild(alertDiv);
                }
                
                // Abrir o modal
                const modal = new bootstrap.Modal(document.getElementById('novoEditalModal'));
                modal.show();
            }
        });

        // Validação apenas no submit do formulário
        const form = document.getElementById('novoEditalForm');
        if (form) {
            form.addEventListener('submit', function(e) {
            // Limpar mensagens anteriores
            const alertasAntigos = document.querySelectorAll('.alert-validacao');
            alertasAntigos.forEach(alerta => alerta.remove());
            
            let erros = [];
            
            // Validar datas de inscrição
            const inicioInscricao = document.getElementById('dataInicioInscricao').value;
            const fimInscricao = document.getElementById('dataFimInscricao').value;
            
            if (inicioInscricao && fimInscricao && inicioInscricao >= fimInscricao) {
                erros.push('A data de fim da inscrição deve ser posterior à data de início');
            }
            
            // Validar datas de vigência
            const inicioVigencia = document.getElementById('dataInicioVigencia').value;
            const fimVigencia = document.getElementById('dataFimVigencia').value;
            
            if (inicioVigencia && fimVigencia && inicioVigencia >= fimVigencia) {
                erros.push('A data de fim da vigência deve ser posterior à data de início');
            }
            
            // Se houver erros, mostrar e cancelar submit
            if (erros.length > 0) {
                e.preventDefault();
                
                const erroContainer = document.getElementById('erroModalContainer');
                erroContainer.innerHTML = ''; // Limpar erros anteriores
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger alert-dismissible fade show alert-validacao mb-3';
                alertDiv.innerHTML = `
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                    <strong>Erro de validação:</strong>
                    <ul class="mb-0 mt-2">
                        ${erros.map(erro => `<li>${erro}</li>`).join('')}
                    </ul>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                erroContainer.appendChild(alertDiv);
            }
        });
        }
    </script>
</body>
</html>
