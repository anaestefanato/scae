<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCAE - Relat√≥rios</title>
    <link rel="icon" type="image/svg+xml" href="/static/img/logo.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/dashboard_assistente.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Melhorias na legibilidade - cores de fundo */
        .report-item {
            padding: 18px;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }
        
        .report-item:hover {
            border-color: #28a745;
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.15);
        }
        
        .report-item h6 {
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 6px;
        }
        
        .report-item .text-muted {
            color: #6c757d !important;
            font-size: 0.9em;
        }
        
        .stats-card {
            text-align: center;
            padding: 25px;
            border-radius: 15px;
            border: none;
            background: linear-gradient(135deg, #ffffff 0%, #f1f3f4 100%);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.2);
            background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        }
        
        .stats-card .number {
            font-size: 2.2rem;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 8px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .stats-card .label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1em;
        }
        
        .stats-card small {
            color: #6c757d;
            font-size: 0.85em;
        }
        
        .page-header {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 35px;
            border-radius: 15px;
            margin-bottom: 35px;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .page-header h4 {
            color: white;
            margin-bottom: 12px;
            font-weight: 600;
            text-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .page-header p {
            color: rgba(255,255,255,0.95);
            font-size: 1.05em;
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            background: #ffffff;
            margin-bottom: 20px;
        }
        
        .card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.12);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }
        
        .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #2c3e50;
            border-radius: 12px 12px 0 0 !important;
            padding: 18px 20px;
        }
        
        .card-body {
            padding: 25px;
            background: #ffffff;
        }
        
        /* Melhorias nos bot√µes */
        .btn-outline-primary {
            border-color: #007bff;
            color: #007bff;
            background: #ffffff;
        }
        
        .btn-outline-primary:hover {
            background: #007bff;
            border-color: #007bff;
            color: #ffffff;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 123, 255, 0.3);
        }
        
        .btn-outline-success {
            border-color: #28a745;
            color: #28a745;
            background: #ffffff;
        }
        
        .btn-outline-success:hover {
            background: #28a745;
            border-color: #28a745;
            color: #ffffff;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(40, 167, 69, 0.3);
        }
        
        .btn-outline-warning {
            border-color: #ffc107;
            color: #856404;
            background: #ffffff;
        }
        
        .btn-outline-warning:hover {
            background: #ffc107;
            border-color: #ffc107;
            color: #212529;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(255, 193, 7, 0.3);
        }
        
        .btn-outline-info {
            border-color: #17a2b8;
            color: #17a2b8;
            background: #ffffff;
        }
        
        .btn-outline-info:hover {
            background: #17a2b8;
            border-color: #17a2b8;
            color: #ffffff;
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(23, 162, 184, 0.3);
        }
        
        .btn-light {
            background: rgba(255,255,255,0.95);
            border: 2px solid rgba(255,255,255,0.8);
            color: #28a745;
            font-weight: 600;
        }
        
        .btn-light:hover {
            background: #ffffff;
            border-color: #ffffff;
            color: #28a745;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Melhorias nos badges */
        .badge {
            font-size: 0.8em;
            padding: 0.6em 0.9em;
            border-radius: 8px;
            font-weight: 500;
        }
        
        .badge.bg-primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%) !important;
        }
        
        .badge.bg-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%) !important;
        }
        
        .badge.bg-warning {
            background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%) !important;
            color: #212529 !important;
        }
        
        .badge.bg-info {
            background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%) !important;
        }
        
        .badge.bg-danger {
            background: linear-gradient(135deg, #dc3545 0%, #bd2130 100%) !important;
        }
        
        /* Melhorias na tabela */
        .table {
            background: #ffffff;
        }
        
        .table th {
            font-weight: 600;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-top: none;
            color: #2c3e50;
            font-size: 0.9em;
            padding: 15px 12px;
        }
        
        .table td {
            padding: 12px;
            vertical-align: middle;
            color: #495057;
            border-top: 1px solid #dee2e6;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(40, 167, 69, 0.05);
        }
        
        /* Melhorias nos formul√°rios */
        .form-control, .form-select {
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 12px 15px;
            background: #ffffff;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.15);
            background: #f8fff9;
        }
        
        .form-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .form-check-input:checked {
            background-color: #28a745;
            border-color: #28a745;
        }
        
        .form-check-label {
            color: #495057;
            font-weight: 500;
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .page-header {
                padding: 25px 20px;
            }
            
            .stats-card {
                margin-bottom: 20px;
            }
            
            .card-body {
                padding: 20px 15px;
                max-height: 300px;
            }
            
            .table-responsive {
                max-height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menuToggle">
        <i class="bi bi-list"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="close-sidebar" id="closeSidebar">
                <i class="bi bi-x-lg"></i>
            </button>
            <img src="/static/img/logoifes.svg" alt="Logo IFES" width="180" loading="lazy">
        </div>
        <div class="d-flex flex-column p-3">
            <div class="mb-4 text-center">
                <h6 class="mb-0">Sistema de Controle de</h6>
                <h6>Assist√™ncia Estudantil</h6>
            </div>
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a href="/assistente/inicio" class="nav-link">
                        <i class="bi bi-speedometer2"></i> <span>In√≠cio</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/agenda" class="nav-link">
                        <i class="bi bi-calendar-event"></i> <span>Agenda</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/alunos" class="nav-link">
                        <i class="bi bi-people"></i> <span>Alunos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/analise-inscricoes" class="nav-link">
                        <i class="bi bi-clipboard-check"></i> <span>An√°lise de Inscri√ß√µes</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/analise-recursos" class="nav-link">
                        <i class="bi bi-journal-text"></i> <span>An√°lise de Recursos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/editais" class="nav-link">
                        <i class="bi bi-file-earmark-ruled"></i> <span>Editais</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/entrevistas" class="nav-link">
                        <i class="bi bi-file-earmark-text"></i> <span>Entrevistas Agendadas</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/perfil" class="nav-link">
                        <i class="bi bi-person-circle"></i> <span>Meu Perfil</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/assistente/relatorios" class="nav-link active bg-success">
                        <i class="bi bi-file-earmark-bar-graph"></i> <span>Relat√≥rios</span>
                    </a>
                </li>
            </ul>
            <hr>
            <div class="text-center">
                <a href="#" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#logoutModal">
                    <i class="bi bi-box-arrow-right"></i> <span>Sair</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="welcome-banner mb-4 card-hover">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h4 class="mb-3">Relat√≥rios da Assist√™ncia Social</h4>
                    <p>Gerencie e gere relat√≥rios anal√≠ticos sobre os aux√≠lios estudantis e atendimentos realizados.</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="user-profile-card">
                        <button class="btn btn-light btn-lg" onclick="exportarPaginaPDF()" title="Exportar p√°gina atual para PDF">
                            <i class="bi bi-file-earmark-pdf me-2"></i>Exportar PDF
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Main Report Generator -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-file-earmark-bar-graph me-2"></i>Gerador de Relat√≥rios</h5>
                    </div>
                    <div class="card-body">
                        <form id="quickReportForm">
                            <div class="row">
                                <div class="col-lg-3 col-md-6">
                                    <div class="mb-3">
                                        <label for="categoriaRelatorio" class="form-label">Categoria do Relat√≥rio</label>
                                        <select class="form-select form-select-lg" id="categoriaRelatorio" required onchange="atualizarTiposRelatorio()">
                                            <option value="">Selecione uma categoria...</option>
                                            <option value="beneficiarios">üìä Benefici√°rios</option>
                                            <option value="financeiro">üí∞ Financeiro</option>
                                            <option value="atendimento">üìã Atendimento</option>
                                            <option value="estatistico">üìà Estat√≠stico</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="mb-3">
                                        <label for="tipoRelatorioRapido" class="form-label">Tipo de Relat√≥rio</label>
                                        <select class="form-select form-select-lg" id="tipoRelatorioRapido" required disabled>
                                            <option value="">Primeiro selecione uma categoria</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4">
                                    <div class="mb-3">
                                        <label for="periodoRapido" class="form-label">Per√≠odo</label>
                                        <select class="form-select form-select-lg" id="periodoRapido">
                                            <option value="mes-atual">M√™s Atual</option>
                                            <option value="mes-anterior">M√™s Anterior</option>
                                            <option value="trimestre">Trimestre Atual</option>
                                            <option value="semestre">Semestre Atual</option>
                                            <option value="personalizado">Personalizado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4">
                                    <div class="mb-3">
                                        <label for="formatoRapido" class="form-label">Formato</label>
                                        <select class="form-select form-select-lg" id="formatoRapido">
                                            <option value="pdf">üìÑ PDF</option>
                                            <option value="excel">üìä Excel</option>
                                            <option value="csv">üìã CSV</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-2 col-md-4">
                                    <div class="mb-3">
                                        <label class="form-label">&nbsp;</label>
                                        <button type="submit" class="btn btn-success btn-lg w-100">
                                            <i class="bi bi-download me-2"></i>Gerar
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Per√≠odo personalizado (hidden por padr√£o) -->
                            <div class="row" id="periodoPersonalizado" style="display: none;">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="dataInicioRapido" class="form-label">Data In√≠cio</label>
                                        <input type="date" class="form-control form-control-lg" id="dataInicioRapido">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="dataFimRapido" class="form-label">Data Fim</label>
                                        <input type="date" class="form-control form-control-lg" id="dataFimRapido">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Options (Collapsible) -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <button class="btn btn-link text-decoration-none w-100 text-start" type="button" data-bs-toggle="collapse" data-bs-target="#opcoesAvancadas">
                            <i class="bi bi-gear me-2"></i>Op√ß√µes Avan√ßadas 
                            <i class="bi bi-chevron-down float-end"></i>
                        </button>
                    </div>
                    <div class="collapse" id="opcoesAvancadas">
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>Filtros de Aux√≠lio</h6>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="filtroTransporte" checked>
                                        <label class="form-check-label" for="filtroTransporte">
                                            üöå Aux√≠lio Transporte
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="filtroAlimentacao" checked>
                                        <label class="form-check-label" for="filtroAlimentacao">
                                            üçΩÔ∏è Aux√≠lio Alimenta√ß√£o
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="filtroMaterial" checked>
                                        <label class="form-check-label" for="filtroMaterial">
                                            üìö Aux√≠lio Material
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="filtroMoradia" checked>
                                        <label class="form-check-label" for="filtroMoradia">
                                            üè† Aux√≠lio Moradia
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <h6>Configura√ß√µes do Relat√≥rio</h6>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="incluirGraficos" checked>
                                        <label class="form-check-label" for="incluirGraficos">
                                            üìä Incluir gr√°ficos
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="incluirTotalizadores" checked>
                                        <label class="form-check-label" for="incluirTotalizadores">
                                            üßÆ Incluir totalizadores
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="incluirComparativos">
                                        <label class="form-check-label" for="incluirComparativos">
                                            üìà Incluir comparativos
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="incluirDetalhes">
                                        <label class="form-check-label" for="incluirDetalhes">
                                            üìã Incluir detalhamento
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Reports -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-clock-history me-2"></i>Relat√≥rios Recentes</span>
                        <button class="btn btn-sm btn-outline-secondary" onclick="limparHistorico()">
                            <i class="bi bi-trash me-1"></i>Limpar Hist√≥rico
                        </button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Relat√≥rio</th>
                                    <th>Data de Gera√ß√£o</th>
                                    <th>Per√≠odo</th>
                                    <th>Formato</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Benefici√°rios por Aux√≠lio</td>
                                    <td>28/09/2025 14:30</td>
                                    <td>Set/2025</td>
                                    <td><span class="badge bg-danger">PDF</span></td>
                                    <td><span class="badge bg-success">Conclu√≠do</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary me-1" title="Download">
                                            <i class="bi bi-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Execu√ß√£o Or√ßament√°ria</td>
                                    <td>27/09/2025 09:15</td>
                                    <td>3¬∫ Trim/2025</td>
                                    <td><span class="badge bg-success">Excel</span></td>
                                    <td><span class="badge bg-success">Conclu√≠do</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary me-1" title="Download">
                                            <i class="bi bi-download"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-info" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>Dashboard Executivo</td>
                                    <td>25/09/2025 16:45</td>
                                    <td>Ago-Set/2025</td>
                                    <td><span class="badge bg-danger">PDF</span></td>
                                    <td><span class="badge bg-warning">Processando</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-secondary" disabled title="Aguarde...">
                                            <i class="bi bi-clock"></i>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        // Menu toggle functionality
        document.addEventListener('DOMContentLoaded', function() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const menuToggle = document.getElementById('menuToggle');
            const closeSidebar = document.getElementById('closeSidebar');
            const sidebarBackdrop = document.createElement('div');
            sidebarBackdrop.className = 'sidebar-backdrop';
            document.body.appendChild(sidebarBackdrop);
            
            function closeSidebarFunction() {
                sidebar.classList.remove('open');
                mainContent.classList.remove('shifted');
                menuToggle.classList.remove('hidden');
                sidebarBackdrop.classList.remove('visible');
                document.body.style.overflow = '';
            }
            
            function openSidebarFunction() {
                sidebar.classList.add('open');
                mainContent.classList.add('shifted');
                menuToggle.classList.add('hidden');
                sidebarBackdrop.classList.add('visible');
                document.body.style.overflow = 'hidden';
            }
            
            // Close sidebar button
            closeSidebar.addEventListener('click', closeSidebarFunction);
            
            // Open sidebar button
            menuToggle.addEventListener('click', openSidebarFunction);

            // Close sidebar when clicking on backdrop
            sidebarBackdrop.addEventListener('click', closeSidebarFunction);

            // Close sidebar when pressing ESC key
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape' && sidebar.classList.contains('open')) {
                    closeSidebarFunction();
                }
            });
        });
    </script>
    <script>
        // Configura√ß√£o dos tipos de relat√≥rio por categoria
        const tiposRelatorio = {
            beneficiarios: [
                { value: 'beneficiarios-auxilio', text: 'Benefici√°rios por Aux√≠lio' },
                { value: 'perfil-socioeconomico', text: 'Perfil Socioecon√¥mico' },
                { value: 'evolucao-beneficiarios', text: 'Evolu√ß√£o de Benefici√°rios' },
                { value: 'beneficiarios-curso', text: 'Benefici√°rios por Curso' }
            ],
            financeiro: [
                { value: 'execucao-orcamentaria', text: 'Execu√ß√£o Or√ßament√°ria' },
                { value: 'gastos-auxilio', text: 'Gastos por Aux√≠lio' },
                { value: 'previsao-gastos', text: 'Previs√£o de Gastos' }
            ],
            atendimento: [
                { value: 'entrevistas-realizadas', text: 'Entrevistas Realizadas' },
                { value: 'analise-inscricoes', text: 'An√°lise de Inscri√ß√µes' },
                { value: 'recursos-analisados', text: 'Recursos Analisados' },
                { value: 'tempo-atendimento', text: 'Tempo de Atendimento' }
            ],
            estatistico: [
                { value: 'dashboard-executivo', text: 'Dashboard Executivo' },
                { value: 'indicadores-eficiencia', text: 'Indicadores de Efici√™ncia' },
                { value: 'comparativo-semestral', text: 'Comparativo Semestral' }
            ]
        };

        // Fun√ß√£o para atualizar tipos de relat√≥rio baseado na categoria
        function atualizarTiposRelatorio() {
            const categoria = document.getElementById('categoriaRelatorio').value;
            const tipoSelect = document.getElementById('tipoRelatorioRapido');
            
            // Limpar op√ß√µes
            tipoSelect.innerHTML = '';
            
            if (categoria) {
                tipoSelect.disabled = false;
                tipoSelect.innerHTML = '<option value="">Selecione um tipo...</option>';
                
                tiposRelatorio[categoria].forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo.value;
                    option.textContent = tipo.text;
                    tipoSelect.appendChild(option);
                });
            } else {
                tipoSelect.disabled = true;
                tipoSelect.innerHTML = '<option value="">Primeiro selecione uma categoria</option>';
            }
        }

        // Fun√ß√£o para mostrar/esconder per√≠odo personalizado
        document.getElementById('periodoRapido').addEventListener('change', function() {
            const periodoPersonalizado = document.getElementById('periodoPersonalizado');
            if (this.value === 'personalizado') {
                periodoPersonalizado.style.display = 'block';
            } else {
                periodoPersonalizado.style.display = 'none';
            }
        });

        // Manipular formul√°rio de relat√≥rio r√°pido
        document.getElementById('quickReportForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const categoria = document.getElementById('categoriaRelatorio').value;
            const tipo = document.getElementById('tipoRelatorioRapido').value;
            const periodo = document.getElementById('periodoRapido').value;
            const formato = document.getElementById('formatoRapido').value;
            
            if (!categoria || !tipo) {
                alert('Por favor, selecione uma categoria e um tipo de relat√≥rio.');
                return;
            }
            
            gerarRelatorioRapido(tipo, periodo, formato);
        });

        // Fun√ß√£o para gerar relat√≥rio r√°pido
        function gerarRelatorioRapido(tipo, periodo, formato) {
            const submitBtn = document.querySelector('#quickReportForm button[type="submit"]');
            const originalContent = submitBtn.innerHTML;
            
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Gerando...';
            
            setTimeout(() => {
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalContent;
                
                // Gerar relat√≥rio baseado no formato
                if (formato === 'pdf') {
                    gerarPDFEspecifico(tipo);
                } else if (formato === 'excel') {
                    gerarExcelEspecifico(tipo);
                } else if (formato === 'csv') {
                    gerarCSVEspecifico(tipo);
                }
                
            }, 2000);
        }

        // Fun√ß√£o para gerar Excel
        function gerarExcelEspecifico(tipo) {
            console.log(`Gerando Excel: ${tipo}`);
            // Simular download de Excel
            const nomeArquivo = `relatorio_${tipo}_${new Date().toISOString().split('T')[0]}.xlsx`;
            alert(`Relat√≥rio Excel "${nomeArquivo}" gerado com sucesso!`);
        }

        // Fun√ß√£o para gerar CSV
        function gerarCSVEspecifico(tipo) {
            console.log(`Gerando CSV: ${tipo}`);
            // Simular download de CSV
            const nomeArquivo = `relatorio_${tipo}_${new Date().toISOString().split('T')[0]}.csv`;
            alert(`Relat√≥rio CSV "${nomeArquivo}" gerado com sucesso!`);
        }

        // Fun√ß√£o para gerar relat√≥rios predefinidos (mantida para compatibilidade)
        function gerarRelatorio(tipo) {
            console.log('Gerando relat√≥rio:', tipo);
            
            // Simular processo de gera√ß√£o
            const btn = event.target;
            const originalContent = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Gerando...';
            
            setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML = originalContent;
                
                // Gerar PDF espec√≠fico baseado no tipo
                gerarPDFEspecifico(tipo);
                
            }, 2000);
        }

        // Fun√ß√£o para gerar PDF espec√≠fico por tipo de relat√≥rio
        function gerarPDFEspecifico(tipo) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Configura√ß√µes b√°sicas
            const pageWidth = doc.internal.pageSize.width;
            const margin = 20;
            let currentY = margin;
            
            // Cabe√ßalho do relat√≥rio
            doc.setFontSize(20);
            doc.setTextColor(40, 167, 69); // Verde
            doc.text('SCAE - Sistema de Controle de Assist√™ncia Estudantil', margin, currentY);
            currentY += 15;
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text('Instituto Federal do Esp√≠rito Santo - Campus Vit√≥ria', margin, currentY);
            currentY += 10;
            
            const dataAtual = new Date().toLocaleDateString('pt-BR');
            doc.text(`Gerado em: ${dataAtual}`, margin, currentY);
            currentY += 20;
            
            // T√≠tulo espec√≠fico do relat√≥rio
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            
            switch(tipo) {
                case 'beneficiarios-auxilio':
                    doc.text('Relat√≥rio: Benefici√°rios por Aux√≠lio', margin, currentY);
                    currentY += 15;
                    gerarRelatorioBeneficiarios(doc, margin, currentY);
                    break;
                    
                case 'perfil-socioeconomico':
                    doc.text('Relat√≥rio: Perfil Socioecon√¥mico', margin, currentY);
                    currentY += 15;
                    gerarRelatorioPerfilSocioeconomico(doc, margin, currentY);
                    break;
                    
                case 'execucao-orcamentaria':
                    doc.text('Relat√≥rio: Execu√ß√£o Or√ßament√°ria', margin, currentY);
                    currentY += 15;
                    gerarRelatorioExecucaoOrcamentaria(doc, margin, currentY);
                    break;
                    
                case 'entrevistas-realizadas':
                    doc.text('Relat√≥rio: Entrevistas Realizadas', margin, currentY);
                    currentY += 15;
                    gerarRelatorioEntrevistas(doc, margin, currentY);
                    break;
                    
                case 'dashboard-executivo':
                    doc.text('Relat√≥rio: Dashboard Executivo', margin, currentY);
                    currentY += 15;
                    gerarRelatorioDashboard(doc, margin, currentY);
                    break;
                    
                default:
                    doc.text(`Relat√≥rio: ${tipo.replace('-', ' ').toUpperCase()}`, margin, currentY);
                    currentY += 15;
                    gerarRelatorioGenerico(doc, margin, currentY, tipo);
            }
            
            // Salvar o PDF
            const nomeArquivo = `relatorio_${tipo}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(nomeArquivo);
            
            alert('Relat√≥rio PDF gerado com sucesso!');
        }

        // Relat√≥rio de Benefici√°rios por Aux√≠lio
        function gerarRelatorioBeneficiarios(doc, margin, startY) {
            let currentY = startY;
            
            doc.setFontSize(12);
            doc.text('Resumo de Benefici√°rios por Tipo de Aux√≠lio', margin, currentY);
            currentY += 15;
            
            const dados = [
                ['Tipo de Aux√≠lio', 'Quantidade', 'Valor M√©dio', 'Total Mensal'],
                ['Aux√≠lio Transporte', '156', 'R$ 180,00', 'R$ 28.080,00'],
                ['Aux√≠lio Alimenta√ß√£o', '98', 'R$ 250,00', 'R$ 24.500,00'],
                ['Aux√≠lio Material Did√°tico', '73', 'R$ 300,00', 'R$ 21.900,00'],
                ['Aux√≠lio Moradia', '15', 'R$ 400,00', 'R$ 6.000,00'],
                ['TOTAL', '342', '-', 'R$ 80.480,00']
            ];
            
            gerarTabela(doc, dados, margin, currentY);
            currentY += dados.length * 10 + 20;
            
            // Adicionar gr√°fico textual
            doc.setFontSize(12);
            doc.text('Distribui√ß√£o Percentual:', margin, currentY);
            currentY += 10;
            
            doc.setFontSize(10);
            doc.text('‚Ä¢ Aux√≠lio Transporte: 45.6% (156 benefici√°rios)', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Aux√≠lio Alimenta√ß√£o: 28.7% (98 benefici√°rios)', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Aux√≠lio Material Did√°tico: 21.3% (73 benefici√°rios)', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Aux√≠lio Moradia: 4.4% (15 benefici√°rios)', margin + 10, currentY);
        }

        // Relat√≥rio de Perfil Socioecon√¥mico
        function gerarRelatorioPerfilSocioeconomico(doc, margin, startY) {
            let currentY = startY;
            
            doc.setFontSize(12);
            doc.text('An√°lise do Perfil Socioecon√¥mico dos Benefici√°rios', margin, currentY);
            currentY += 15;
            
            const dados = [
                ['Faixa de Renda Per Capita', 'Quantidade', 'Percentual'],
                ['At√© R$ 250,00', '198', '57.9%'],
                ['R$ 250,01 - R$ 500,00', '89', '26.0%'],
                ['R$ 500,01 - R$ 750,00', '38', '11.1%'],
                ['R$ 750,01 - R$ 1.000,00', '17', '5.0%'],
                ['TOTAL', '342', '100%']
            ];
            
            gerarTabela(doc, dados, margin, currentY);
            currentY += dados.length * 10 + 20;
            
            doc.text('Composi√ß√£o Familiar M√©dia:', margin, currentY);
            currentY += 10;
            doc.setFontSize(10);
            doc.text('‚Ä¢ 3,2 pessoas por fam√≠lia', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ 89% s√£o arrimo de fam√≠lia ou dependentes √∫nicos', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ 76% residem em bairros perif√©ricos', margin + 10, currentY);
        }

        // Relat√≥rio de Execu√ß√£o Or√ßament√°ria
        function gerarRelatorioExecucaoOrcamentaria(doc, margin, startY) {
            let currentY = startY;
            
            doc.setFontSize(12);
            doc.text('Execu√ß√£o Or√ßament√°ria - Outubro 2025', margin, currentY);
            currentY += 15;
            
            const dados = [
                ['Item', 'Or√ßado', 'Executado', '% Execu√ß√£o'],
                ['Aux√≠lio Transporte', 'R$ 30.000,00', 'R$ 28.080,00', '93.6%'],
                ['Aux√≠lio Alimenta√ß√£o', 'R$ 25.000,00', 'R$ 24.500,00', '98.0%'],
                ['Aux√≠lio Material', 'R$ 22.000,00', 'R$ 21.900,00', '99.5%'],
                ['Aux√≠lio Moradia', 'R$ 8.000,00', 'R$ 6.000,00', '75.0%'],
                ['TOTAL', 'R$ 85.000,00', 'R$ 80.480,00', '94.7%']
            ];
            
            gerarTabela(doc, dados, margin, currentY);
            currentY += dados.length * 10 + 20;
            
            doc.text('Observa√ß√µes:', margin, currentY);
            currentY += 10;
            doc.setFontSize(10);
            doc.text('‚Ä¢ Execu√ß√£o dentro da meta estabelecida (>90%)', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Aux√≠lio Moradia com menor execu√ß√£o devido a menor demanda', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Previs√£o de 100% de execu√ß√£o at√© final do m√™s', margin + 10, currentY);
        }

        // Relat√≥rio de Entrevistas
        function gerarRelatorioEntrevistas(doc, margin, startY) {
            let currentY = startY;
            
            doc.setFontSize(12);
            doc.text('Entrevistas Realizadas - √öltimos 30 dias', margin, currentY);
            currentY += 15;
            
            const dados = [
                ['Tipo de Entrevista', 'Quantidade', 'Tempo M√©dio'],
                ['Entrevista Inicial', '67', '45 min'],
                ['Reavalia√ß√£o', '34', '30 min'],
                ['Acompanhamento', '19', '25 min'],
                ['Renova√ß√£o de Aux√≠lio', '7', '20 min'],
                ['TOTAL', '127', '35 min']
            ];
            
            gerarTabela(doc, dados, margin, currentY);
            currentY += dados.length * 10 + 20;
            
            doc.text('Resultados das Entrevistas:', margin, currentY);
            currentY += 10;
            doc.setFontSize(10);
            doc.text('‚Ä¢ 89% resultaram em aprova√ß√£o de aux√≠lio', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ 8% necessitaram documenta√ß√£o complementar', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ 3% foram indeferidas', margin + 10, currentY);
        }

        // Relat√≥rio Dashboard Executivo
        function gerarRelatorioDashboard(doc, margin, startY) {
            let currentY = startY;
            
            doc.setFontSize(12);
            doc.text('Indicadores Executivos - Outubro 2025', margin, currentY);
            currentY += 15;
            
            // KPIs principais
            doc.text('Principais Indicadores:', margin, currentY);
            currentY += 10;
            
            doc.setFontSize(10);
            doc.text('‚Ä¢ Total de Benefici√°rios Ativos: 342 alunos', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Investimento Mensal: R$ 80.480,00', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Taxa de Perman√™ncia: 94.5%', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Tempo M√©dio de An√°lise: 5.2 dias', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Satisfa√ß√£o dos Benefici√°rios: 4.7/5.0', margin + 10, currentY);
            currentY += 15;
            
            // Metas vs Realizado
            const dados = [
                ['Indicador', 'Meta', 'Realizado', 'Status'],
                ['Benefici√°rios', '350', '342', '97.7%'],
                ['Execu√ß√£o Or√ßament√°ria', '90%', '94.7%', '‚úì'],
                ['Tempo de An√°lise', '7 dias', '5.2 dias', '‚úì'],
                ['Taxa de Renova√ß√£o', '85%', '89%', '‚úì']
            ];
            
            gerarTabela(doc, dados, margin, currentY);
        }

        // Relat√≥rio Gen√©rico
        function gerarRelatorioGenerico(doc, margin, startY, tipo) {
            let currentY = startY;
            
            doc.setFontSize(12);
            doc.text(`Dados do relat√≥rio ${tipo.replace('-', ' ')}:`, margin, currentY);
            currentY += 15;
            
            doc.setFontSize(10);
            doc.text('‚Ä¢ Este relat√≥rio cont√©m informa√ß√µes detalhadas sobre o tema solicitado', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Os dados foram coletados do sistema SCAE', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Per√≠odo de refer√™ncia: Outubro 2025', margin + 10, currentY);
            currentY += 8;
            doc.text('‚Ä¢ Relat√≥rio gerado automaticamente', margin + 10, currentY);
        }

        // Fun√ß√£o para gerar tabelas no PDF
        function gerarTabela(doc, dados, x, y) {
            const cellHeight = 8;
            const cellWidth = 35;
            
            dados.forEach((row, rowIndex) => {
                row.forEach((cell, cellIndex) => {
                    const cellX = x + (cellIndex * cellWidth);
                    const cellY = y + (rowIndex * cellHeight);
                    
                    // Cabe√ßalho com fundo cinza
                    if (rowIndex === 0) {
                        doc.setFillColor(240, 240, 240);
                        doc.rect(cellX, cellY - 6, cellWidth, cellHeight, 'F');
                        doc.setFontSize(9);
                        doc.setFont(undefined, 'bold');
                    } else {
                        doc.setFontSize(8);
                        doc.setFont(undefined, 'normal');
                    }
                    
                    // Bordas
                    doc.rect(cellX, cellY - 6, cellWidth, cellHeight);
                    
                    // Texto
                    doc.text(cell, cellX + 2, cellY - 1);
                });
            });
        }

        // Fun√ß√£o para exportar a p√°gina atual como PDF
        function exportarPaginaPDF() {
            const btn = event.target;
            const originalContent = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<i class="bi bi-hourglass-split"></i> Gerando...';
            
            // Usar html2canvas para capturar a p√°gina
            html2canvas(document.querySelector('.main-content'), {
                scale: 2,
                useCORS: true,
                allowTaint: true
            }).then(canvas => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;
                
                let position = 0;
                
                // Adicionar cabe√ßalho personalizado
                doc.setFontSize(16);
                doc.setTextColor(40, 167, 69);
                doc.text('SCAE - Relat√≥rios da Assist√™ncia Social', 20, 20);
                
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}`, 20, 30);
                
                position = 40;
                
                // Adicionar a imagem da p√°gina
                const imgData = canvas.toDataURL('image/png');
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                // Adicionar p√°ginas extras se necess√°rio
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    doc.addPage();
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                // Salvar
                const dataAtual = new Date().toISOString().split('T')[0];
                doc.save(`relatorios_assistencia_social_${dataAtual}.pdf`);
                
                btn.disabled = false;
                btn.innerHTML = originalContent;
                
                alert('P√°gina exportada para PDF com sucesso!');
            }).catch(error => {
                console.error('Erro ao gerar PDF:', error);
                btn.disabled = false;
                btn.innerHTML = originalContent;
                alert('Erro ao gerar PDF. Tente novamente.');
            });
        }

        // Fun√ß√£o para limpar formul√°rio personalizado
        function limparFormulario() {
            document.getElementById('quickReportForm').reset();
            document.getElementById('periodoPersonalizado').style.display = 'none';
            atualizarTiposRelatorio();
        }

        // Fun√ß√£o para limpar hist√≥rico
        function limparHistorico() {
            if (confirm('Tem certeza que deseja limpar o hist√≥rico de relat√≥rios?')) {
                console.log('Hist√≥rico limpo');
                alert('Hist√≥rico limpo com sucesso!');
            }
        }

        // Definir data padr√£o (√∫ltimo m√™s)
        document.addEventListener('DOMContentLoaded', function() {
            const hoje = new Date();
            const umMesAtras = new Date(hoje);
            umMesAtras.setMonth(hoje.getMonth() - 1);
            
            document.getElementById('dataInicioRapido').value = umMesAtras.toISOString().split('T')[0];
            document.getElementById('dataFimRapido').value = hoje.toISOString().split('T')[0];
        });
    </script>

    <footer class="footer bg-success text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="text-white mb-0">
                        &copy; 2025 Sistema de Controle de Assist√™ncia Estudantil. Todos os direitos reservados.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal de Confirma√ß√£o de Logout -->
    <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logoutModalLabel">
                        <i class="bi bi-exclamation-triangle text-warning me-2"></i>Confirmar Sa√≠da
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Tem certeza que deseja sair do sistema?</p>
                    <div class="alert alert-info mb-0">
                        <i class="bi bi-info-circle me-2"></i>
                        Voc√™ precisar√° fazer login novamente para acessar o sistema.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-1"></i>Cancelar
                    </button>
                    <a href="/logout" class="btn btn-danger">
                        <i class="bi bi-box-arrow-right me-1"></i>Confirmar Sa√≠da
                    </a>
                </div>
            </div>
        </div>
    </div>
</body>
</html>