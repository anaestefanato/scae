<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCAE - Mensagens</title>
    <link rel="icon" type="image/png" href="/static/img/logo.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/dashboard_admin.css" />
    <link rel="stylesheet" href="/static/css/mensagens.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Menu Toggle Button (visible when sidebar is collapsed) -->
    <button class="menu-toggle" id="menuToggle">
        <i class="bi bi-list"></i>
    </button>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="close-sidebar" id="closeSidebar">
                <i class="bi bi-x-lg"></i>
            </button>
            <img src="/static/img/logoifes.png" alt="Logo IFES" width="180">
        </div>
        <div class="d-flex flex-column p-3">
            <div class="mb-4 text-center">
                <h6 class="mb-0">Sistema de Controle de</h6>
                <h6>Assistência Estudantil</h6>
            </div>
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a href="/admin/inicio" class="nav-link">
                        <i class="bi bi-speedometer2"></i> <span>Início</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link submenu-toggle" data-submenu="usuarios">
                        <div class="nav-content">
                            <i class="bi bi-people"></i> <span>Usuários</span>
                        </div>
                        <i class="bi bi-chevron-down submenu-arrow"></i>
                    </a>
                    <ul class="submenu" id="submenu-usuarios">
                        <li class="nav-item">
                            <a href="/admin/usuarios/assistentes" class="nav-link">
                                <i class="bi bi-person-badge"></i> <span>Assistentes Sociais</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a href="/admin/relatorios" class="nav-link">
                        <i class="bi bi-file-earmark-bar-graph"></i> <span>Relatórios</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/chamados" class="nav-link">
                        <i class="bi bi-chat-dots"></i> <span>Chamados</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin/mensagens" class="nav-link active bg-success">
                        <i class="bi bi-envelope"></i> <span>Mensagens</span>
                    </a>
                </li>
            </ul>
            <hr>
            <div class="text-center">
                <a href="/logout" class="btn btn-outline-danger">
                    <i class="bi bi-box-arrow-right"></i> <span>Sair</span>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Header com Breadcrumb -->
        <div class="page-header mb-4">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/admin/dashboard">Dashboard</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Mensagens</li>
                </ol>
            </nav>
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="page-title" style="color: #333333;">Gerenciar Mensagens</h2>
                    <p class="page-subtitle">Envie comunicados e gerencie mensagens do sistema</p>
                </div>
            </div>
        </div>

        <!-- Filtros e Busca -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <i class="bi bi-funnel me-2"></i>
                    <span>Filtros</span>
                </div>
                <button class="btn btn-sm btn-outline-light" onclick="clearFilters()">
                    <i class="bi bi-x-circle me-1"></i>Limpar Filtros
                </button>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <label for="filterType" class="form-label">Tipo</label>
                        <select class="form-select" id="filterType" onchange="filterMessages()">
                            <option value="">Todos os tipos</option>
                            <option value="enviada">Enviadas</option>
                            <option value="recebida">Recebidas</option>
                            <option value="rascunho">Rascunhos</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="filterStatus" class="form-label">Status</label>
                        <select class="form-select" id="filterStatus" onchange="filterMessages()">
                            <option value="">Todos os status</option>
                            <option value="lida">Lida</option>
                            <option value="nao-lida">Não Lida</option>
                            <option value="arquivada">Arquivada</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="filterCategory" class="form-label">Categoria</label>
                        <select class="form-select" id="filterCategory" onchange="filterMessages()">
                            <option value="">Todas as categorias</option>
                            <option value="comunicado">Comunicado Geral</option>
                            <option value="auxilio">Auxílios</option>
                            <option value="edital">Editais</option>
                            <option value="sistema">Sistema</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="searchMessage" class="form-label">Buscar</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchMessage" placeholder="Buscar mensagem...">
                            <button class="btn btn-outline-success" onclick="searchMessages()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Mensagens -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <i class="bi bi-envelope me-2"></i>
                    <span>Lista de Mensagens</span>
                    <span class="badge bg-info ms-2" id="messagesCount">8</span>
                </div>
                <div>
                    <button class="btn btn-sm btn-outline-light me-2" onclick="markAllAsRead()">
                        <i class="bi bi-check-all me-1"></i>Marcar Todas como Lidas
                    </button>
                    <button class="btn btn-sm btn-outline-light" onclick="refreshMessages()">
                        <i class="bi bi-arrow-clockwise me-1"></i>Atualizar
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="messages-list">
                    <!-- Mensagem 1 -->
                    <div class="message-item unread" data-message-id="1">
                        <div class="message-indicator"></div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">
                                    <i class="bi bi-person-circle me-2"></i>
                                    <strong>João Silva Santos</strong>
                                    <span class="message-category badge bg-primary ms-2">Auxílios</span>
                                </div>
                                <div class="message-meta">
                                    <span class="message-time">13/09/2025 14:30</span>
                                    <div class="message-actions">
                                        <button class="btn btn-sm btn-outline-info" onclick="viewMessage(1)" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" onclick="replyMessage(1)" title="Responder">
                                            <i class="bi bi-reply"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteMessage(1)" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="message-subject">
                                <strong>Dúvida sobre auxílio alimentação</strong>
                            </div>
                            <div class="message-preview">
                                Gostaria de saber sobre os critérios para renovação do auxílio alimentação no próximo semestre...
                            </div>
                        </div>
                    </div>

                    <!-- Mensagem 2 -->
                    <div class="message-item read" data-message-id="2">
                        <div class="message-indicator"></div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">
                                    <i class="bi bi-person-circle me-2"></i>
                                    <strong>Maria Costa Lima</strong>
                                    <span class="message-category badge bg-warning ms-2">Edital</span>
                                </div>
                                <div class="message-meta">
                                    <span class="message-time">12/09/2025 16:45</span>
                                    <div class="message-actions">
                                        <button class="btn btn-sm btn-outline-info" onclick="viewMessage(2)" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" onclick="replyMessage(2)" title="Responder">
                                            <i class="bi bi-reply"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteMessage(2)" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="message-subject">
                                <strong>Prazo para inscrição em novo edital</strong>
                            </div>
                            <div class="message-preview">
                                Quando será divulgado o próximo edital de auxílio transporte? Preciso me inscrever...
                            </div>
                        </div>
                    </div>

                    <!-- Mensagem 3 -->
                    <div class="message-item unread" data-message-id="3">
                        <div class="message-indicator"></div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">
                                    <i class="bi bi-person-circle me-2"></i>
                                    <strong>Pedro Oliveira Santos</strong>
                                    <span class="message-category badge bg-info ms-2">Sistema</span>
                                </div>
                                <div class="message-meta">
                                    <span class="message-time">11/09/2025 10:15</span>
                                    <div class="message-actions">
                                        <button class="btn btn-sm btn-outline-info" onclick="viewMessage(3)" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" onclick="replyMessage(3)" title="Responder">
                                            <i class="bi bi-reply"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteMessage(3)" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="message-subject">
                                <strong>Problema no login do sistema</strong>
                            </div>
                            <div class="message-preview">
                                Não consigo acessar minha conta no sistema, sempre aparece erro de credenciais...
                            </div>
                        </div>
                    </div>

                    <!-- Mensagem 4 -->
                    <div class="message-item read" data-message-id="4">
                        <div class="message-indicator"></div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-sender">
                                    <i class="bi bi-person-circle me-2"></i>
                                    <strong>Ana Ferreira Costa</strong>
                                    <span class="message-category badge bg-success ms-2">Comunicado</span>
                                </div>
                                <div class="message-meta">
                                    <span class="message-time">10/09/2025 08:30</span>
                                    <div class="message-actions">
                                        <button class="btn btn-sm btn-outline-info" onclick="viewMessage(4)" title="Visualizar">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-success" onclick="replyMessage(4)" title="Responder">
                                            <i class="bi bi-reply"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="deleteMessage(4)" title="Excluir">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="message-subject">
                                <strong>Agradecimento pelos serviços</strong>
                            </div>
                            <div class="message-preview">
                                Gostaria de agradecer pela rapidez no atendimento e pela ajuda com meu auxílio...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer">
                <nav aria-label="Navegação da lista de mensagens">
                    <ul class="pagination pagination-sm justify-content-center mb-0">
                        <li class="page-item disabled">
                            <a class="page-link" href="#">Anterior</a>
                        </li>
                        <li class="page-item active">
                            <a class="page-link" href="#">1</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">2</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">Próximo</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <!-- Modal de Visualização de Mensagem -->
    <div class="modal fade" id="viewMessageModal" tabindex="-1" aria-labelledby="viewMessageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewMessageModalLabel">
                        <i class="bi bi-envelope-open me-2"></i>Visualizar Mensagem
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="message-details">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <strong>De:</strong> <span id="modalSender">João Silva Santos</span>
                            </div>
                            <div class="col-md-6">
                                <strong>Data:</strong> <span id="modalDate">13/09/2025 14:30</span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <strong>Categoria:</strong> <span id="modalCategory" class="badge bg-primary">Auxílios</span>
                            </div>
                            <div class="col-md-6">
                                <strong>Status:</strong> <span id="modalStatus" class="badge bg-warning">Não Lida</span>
                            </div>
                        </div>
                        <div class="mb-3">
                            <strong>Assunto:</strong> <span id="modalSubject">Dúvida sobre auxílio alimentação</span>
                        </div>
                        <div class="message-body">
                            <strong>Mensagem:</strong>
                            <div class="message-text mt-2" id="modalMessageText">
                                <p>Prezada equipe,</p>
                                <p>Gostaria de saber sobre os critérios para renovação do auxílio alimentação no próximo semestre. Atualmente recebo o auxílio e preciso saber se devo fazer uma nova inscrição ou se a renovação é automática.</p>
                                <p>Também gostaria de confirmar os documentos necessários para o processo.</p>
                                <p>Aguardo retorno.</p>
                                <p>Atenciosamente,<br>João Silva Santos</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="replyFromModal()">
                        <i class="bi bi-reply me-2"></i>Responder
                    </button>
                    <button type="button" class="btn btn-warning" onclick="markAsRead()">
                        <i class="bi bi-check me-2"></i>Marcar como Lida
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Nova Mensagem/Resposta -->
    <div class="modal fade" id="composeMessageModal" tabindex="-1" aria-labelledby="composeMessageModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="composeMessageModalLabel">
                        <i class="bi bi-envelope-plus me-2"></i>Nova Mensagem
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="messageTo" class="form-label">Para</label>
                                <input type="text" class="form-control" id="messageTo" placeholder="Digite o email ou nome do destinatário">
                            </div>
                            <div class="col-md-6">
                                <label for="messageCategory" class="form-label">Categoria</label>
                                <select class="form-select" id="messageCategory">
                                    <option value="comunicado">Comunicado Geral</option>
                                    <option value="auxilio">Auxílios</option>
                                    <option value="edital">Editais</option>
                                    <option value="sistema">Sistema</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="messageSubject" class="form-label">Assunto</label>
                            <input type="text" class="form-control" id="messageSubject" placeholder="Digite o assunto da mensagem">
                        </div>
                        <div class="mb-3">
                            <label for="messageBody" class="form-label">Mensagem</label>
                            <textarea class="form-control" id="messageBody" rows="8" placeholder="Digite aqui sua mensagem..."></textarea>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="sendCopy">
                            <label class="form-check-label" for="sendCopy">
                                Enviar cópia para meu email
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="sendMessage()">
                        <i class="bi bi-send me-2"></i>Enviar Mensagem
                    </button>
                    <button type="button" class="btn btn-outline-secondary" onclick="saveDraft()">
                        <i class="bi bi-save me-2"></i>Salvar como Rascunho
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/dashboard_admin.js"></script>
    
    <script>
        // Message management functions
        function viewMessage(messageId) {
            // Show message details modal
            const modal = new bootstrap.Modal(document.getElementById('viewMessageModal'));
            modal.show();
            
            // Mark as read when viewing
            markMessageAsRead(messageId);
        }

        function replyMessage(messageId) {
            // Show compose modal for reply
            document.getElementById('composeMessageModalLabel').innerHTML = '<i class="bi bi-reply me-2"></i>Responder Mensagem';
            const modal = new bootstrap.Modal(document.getElementById('composeMessageModal'));
            modal.show();
        }

        function deleteMessage(messageId) {
            if (confirm('Tem certeza que deseja excluir esta mensagem?')) {
                alert(`Mensagem excluída!`);
                // Remove message from list
                const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
                if (messageElement) {
                    messageElement.remove();
                }
            }
        }

        function composeMessage() {
            document.getElementById('composeMessageModalLabel').innerHTML = '<i class="bi bi-envelope-plus me-2"></i>Nova Mensagem';
            // Clear form
            document.getElementById('messageTo').value = '';
            document.getElementById('messageSubject').value = '';
            document.getElementById('messageBody').value = '';
            
            const modal = new bootstrap.Modal(document.getElementById('composeMessageModal'));
            modal.show();
        }

        function markMessageAsRead(messageId) {
            const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
            if (messageElement && messageElement.classList.contains('unread')) {
                messageElement.classList.remove('unread');
                messageElement.classList.add('read');
            }
        }

        function markAllAsRead() {
            const unreadMessages = document.querySelectorAll('.message-item.unread');
            unreadMessages.forEach(message => {
                message.classList.remove('unread');
                message.classList.add('read');
            });
            alert('Todas as mensagens foram marcadas como lidas!');
        }

        function filterMessages() {
            alert('Aplicando filtros...');
            // Here you would implement the filtering logic
        }

        function clearFilters() {
            document.getElementById('filterType').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterCategory').value = '';
            document.getElementById('searchMessage').value = '';
            alert('Filtros limpos!');
        }

        function searchMessages() {
            const searchTerm = document.getElementById('searchMessage').value;
            if (searchTerm.trim() === '') {
                alert('Digite um termo de busca');
                return;
            }
            alert(`Buscando por: ${searchTerm}`);
        }

        function refreshMessages() {
            alert('Atualizando lista de mensagens...');
        }

        function replyFromModal() {
            bootstrap.Modal.getInstance(document.getElementById('viewMessageModal')).hide();
            setTimeout(() => {
                replyMessage(1); // Current message ID
            }, 300);
        }

        function markAsRead() {
            alert('Mensagem marcada como lida!');
            bootstrap.Modal.getInstance(document.getElementById('viewMessageModal')).hide();
        }

        function sendMessage() {
            const to = document.getElementById('messageTo').value;
            const subject = document.getElementById('messageSubject').value;
            const body = document.getElementById('messageBody').value;
            
            if (!to || !subject || !body) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }
            
            alert('Mensagem enviada com sucesso!');
            bootstrap.Modal.getInstance(document.getElementById('composeMessageModal')).hide();
        }

        function saveDraft() {
            alert('Mensagem salva como rascunho!');
            bootstrap.Modal.getInstance(document.getElementById('composeMessageModal')).hide();
        }
    </script>

    <footer class="footer bg-success text-white py-4">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="text-white mb-0">
                        © 2025 IFES - Instituto Federal do Espírito Santo. Sistema de Controle de Assistência Estudantil.
                    </p>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>
